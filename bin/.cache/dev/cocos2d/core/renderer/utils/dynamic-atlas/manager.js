
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'engine-dev/cocos2d/core/renderer/utils/dynamic-atlas/manager.js';
                    var __require = nodeEnv ? function (request) {
                        return require(request);
                    } : function (request) {
                        return __quick_compile_engine__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_engine__.registerModule(__filename, module);}"use strict";

var Atlas = require('./atlas');

var _atlases = [];

var _atlasIndex = -1;

var _maxAtlasCount = 5;
var _textureSize = 2048;
var _maxFrameSize = 512;
var _textureBleeding = true;
var _debugNode = null;

function newAtlas() {
  var atlas = _atlases[++_atlasIndex];

  if (!atlas) {
    atlas = new Atlas(_textureSize, _textureSize);

    _atlases.push(atlas);
  }

  return atlas;
}

function beforeSceneLoad() {
  dynamicAtlasManager.reset();
}

var _enabled = false;
/**
 * !#en Manage Dynamic Atlas Manager. Dynamic Atlas Manager is used for merging textures at runtime, see [Dynamic Atlas](https://docs.cocos.com/creator/manual/en/advanced-topics/dynamic-atlas.html) for details.
 * !#zh 管理动态图集。动态图集用于在运行时对贴图进行合并，详见 [动态合图](https://docs.cocos.com/creator/manual/zh/advanced-topics/dynamic-atlas.html)。
 * @class DynamicAtlasManager
 */

var dynamicAtlasManager = {
  Atlas: Atlas,

  /**
   * !#en Enable or disable the dynamic atlas, see [Dynamic Atlas](https://docs.cocos.com/creator/manual/en/advanced-topics/dynamic-atlas.html) for details.
   * !#zh 开启或者关闭动态图集，详见 [动态合图](https://docs.cocos.com/creator/manual/zh/advanced-topics/dynamic-atlas.html)。
   * @property enabled
   * @type {Boolean}
   */
  get enabled() {
    return _enabled;
  },

  set enabled(value) {
    if (_enabled === value) return;

    if (value) {
      this.reset();
      cc.director.on(cc.Director.EVENT_BEFORE_SCENE_LAUNCH, beforeSceneLoad);
    } else {
      cc.director.off(cc.Director.EVENT_BEFORE_SCENE_LAUNCH, beforeSceneLoad);
    }

    _enabled = value;
  },

  /**
   * !#en The maximum number of atlas that can be created.
   * !#zh 可以创建的最大图集数量。
   * @property maxAtlasCount
   * @type {Number}
   */
  get maxAtlasCount() {
    return _maxAtlasCount;
  },

  set maxAtlasCount(value) {
    _maxAtlasCount = value;
  },

  /**
   * !#en Is enable textureBleeding.
   * !#zh 是否开启 textureBleeding
   * @property textureBleeding
   * @type {Boolean}
   */
  get textureBleeding() {
    return _textureBleeding;
  },

  set textureBleeding(enable) {
    _textureBleeding = enable;
  },

  /**
   * !#en The size of the atlas that was created
   * !#zh 创建的图集的宽高
   * @property textureSize
   * @type {Number}
   */
  get textureSize() {
    return _textureSize;
  },

  set textureSize(value) {
    _textureSize = value;
  },

  /**
   * !#en The maximum size of the picture that can be added to the atlas.
   * !#zh 可以添加进图集的图片的最大尺寸。
   * @property maxFrameSize
   * @type {Number}
   */
  get maxFrameSize() {
    return _maxFrameSize;
  },

  set maxFrameSize(value) {
    _maxFrameSize = value;
  },

  /**
   * !#en The minimum size of the picture that can be added to the atlas.
   * !#zh 可以添加进图集的图片的最小尺寸。
   * @property minFrameSize
   * @type {Number}
   * @deprecated
   */

  /**
   * !#en Append a sprite frame into the dynamic atlas.
   * !#zh 添加碎图进入动态图集。
   * @method insertSpriteFrame
   * @param {SpriteFrame} spriteFrame 
   */
  insertSpriteFrame: function insertSpriteFrame(spriteFrame) {
    if (CC_EDITOR) return null;
    if (!_enabled || _atlasIndex === _maxAtlasCount || !spriteFrame || spriteFrame._original) return null;
    if (!spriteFrame._texture.packable) return null;
    var atlas = _atlases[_atlasIndex];

    if (!atlas) {
      atlas = newAtlas();
    }

    var frame = atlas.insertSpriteFrame(spriteFrame);

    if (!frame && _atlasIndex !== _maxAtlasCount) {
      atlas = newAtlas();
      return atlas.insertSpriteFrame(spriteFrame);
    }

    return frame;
  },

  /** 
   * !#en Resets all dynamic atlas, and the existing ones will be destroyed.
   * !#zh 重置所有动态图集，已有的动态图集会被销毁。
   * @method reset
  */
  reset: function reset() {
    for (var i = 0, l = _atlases.length; i < l; i++) {
      _atlases[i].destroy();
    }

    _atlases.length = 0;
    _atlasIndex = -1;
  },
  deleteAtlasSpriteFrame: function deleteAtlasSpriteFrame(spriteFrame) {
    if (!spriteFrame._original) return;
    var texture = spriteFrame._original._texture;
    this.deleteAtlasTexture(texture);
  },
  deleteAtlasTexture: function deleteAtlasTexture(texture) {
    if (texture) {
      for (var i = _atlases.length - 1; i >= 0; i--) {
        _atlases[i].deleteInnerTexture(texture);

        if (_atlases[i].isEmpty()) {
          _atlases[i].destroy();

          _atlases.splice(i, 1);

          _atlasIndex--;
        }
      }
    }
  },

  /**
   * !#en Displays all the dynamic atlas in the current scene, which you can use to view the current atlas state.
   * !#zh 在当前场景中显示所有动态图集，可以用来查看当前的合图状态。
   * @method showDebug
   * @param {Boolean} show
   */
  showDebug: CC_DEV && function (show) {
    if (show) {
      if (!_debugNode || !_debugNode.isValid) {
        var width = cc.visibleRect.width;
        var height = cc.visibleRect.height;
        _debugNode = new cc.Node('DYNAMIC_ATLAS_DEBUG_NODE');
        _debugNode.width = width;
        _debugNode.height = height;
        _debugNode.x = width / 2;
        _debugNode.y = height / 2;
        _debugNode.zIndex = cc.macro.MAX_ZINDEX;
        _debugNode.parent = cc.director.getScene();
        _debugNode.groupIndex = cc.Node.BuiltinGroupIndex.DEBUG;

        cc.Camera._setupDebugCamera();

        var scroll = _debugNode.addComponent(cc.ScrollView);

        var content = new cc.Node('CONTENT');
        var layout = content.addComponent(cc.Layout);
        layout.type = cc.Layout.Type.VERTICAL;
        layout.resizeMode = cc.Layout.ResizeMode.CONTAINER;
        content.parent = _debugNode;
        content.width = _textureSize;
        content.anchorY = 1;
        content.x = _textureSize;
        scroll.content = content;

        for (var i = 0; i <= _atlasIndex; i++) {
          var node = new cc.Node('ATLAS');
          var texture = _atlases[i]._texture;
          var spriteFrame = new cc.SpriteFrame();
          spriteFrame.setTexture(_atlases[i]._texture);
          var sprite = node.addComponent(cc.Sprite);
          sprite.spriteFrame = spriteFrame;
          node.parent = content;
        }
      }
    } else {
      if (_debugNode) {
        _debugNode.parent = null;
        _debugNode = null;
      }
    }
  },
  update: function update() {
    if (!this.enabled) return;

    for (var i = 0; i <= _atlasIndex; i++) {
      _atlases[i].update();
    }
  }
};
/**
 * @module cc
 */

/**
 * @property dynamicAtlasManager
 * @type DynamicAtlasManager
 */

module.exports = cc.dynamicAtlasManager = dynamicAtlasManager;
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_engine__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1hbmFnZXIuanMiXSwibmFtZXMiOlsiQXRsYXMiLCJyZXF1aXJlIiwiX2F0bGFzZXMiLCJfYXRsYXNJbmRleCIsIl9tYXhBdGxhc0NvdW50IiwiX3RleHR1cmVTaXplIiwiX21heEZyYW1lU2l6ZSIsIl90ZXh0dXJlQmxlZWRpbmciLCJfZGVidWdOb2RlIiwibmV3QXRsYXMiLCJhdGxhcyIsInB1c2giLCJiZWZvcmVTY2VuZUxvYWQiLCJkeW5hbWljQXRsYXNNYW5hZ2VyIiwicmVzZXQiLCJfZW5hYmxlZCIsImVuYWJsZWQiLCJ2YWx1ZSIsImNjIiwiZGlyZWN0b3IiLCJvbiIsIkRpcmVjdG9yIiwiRVZFTlRfQkVGT1JFX1NDRU5FX0xBVU5DSCIsIm9mZiIsIm1heEF0bGFzQ291bnQiLCJ0ZXh0dXJlQmxlZWRpbmciLCJlbmFibGUiLCJ0ZXh0dXJlU2l6ZSIsIm1heEZyYW1lU2l6ZSIsImluc2VydFNwcml0ZUZyYW1lIiwic3ByaXRlRnJhbWUiLCJDQ19FRElUT1IiLCJfb3JpZ2luYWwiLCJfdGV4dHVyZSIsInBhY2thYmxlIiwiZnJhbWUiLCJpIiwibCIsImxlbmd0aCIsImRlc3Ryb3kiLCJkZWxldGVBdGxhc1Nwcml0ZUZyYW1lIiwidGV4dHVyZSIsImRlbGV0ZUF0bGFzVGV4dHVyZSIsImRlbGV0ZUlubmVyVGV4dHVyZSIsImlzRW1wdHkiLCJzcGxpY2UiLCJzaG93RGVidWciLCJDQ19ERVYiLCJzaG93IiwiaXNWYWxpZCIsIndpZHRoIiwidmlzaWJsZVJlY3QiLCJoZWlnaHQiLCJOb2RlIiwieCIsInkiLCJ6SW5kZXgiLCJtYWNybyIsIk1BWF9aSU5ERVgiLCJwYXJlbnQiLCJnZXRTY2VuZSIsImdyb3VwSW5kZXgiLCJCdWlsdGluR3JvdXBJbmRleCIsIkRFQlVHIiwiQ2FtZXJhIiwiX3NldHVwRGVidWdDYW1lcmEiLCJzY3JvbGwiLCJhZGRDb21wb25lbnQiLCJTY3JvbGxWaWV3IiwiY29udGVudCIsImxheW91dCIsIkxheW91dCIsInR5cGUiLCJUeXBlIiwiVkVSVElDQUwiLCJyZXNpemVNb2RlIiwiUmVzaXplTW9kZSIsIkNPTlRBSU5FUiIsImFuY2hvclkiLCJub2RlIiwiU3ByaXRlRnJhbWUiLCJzZXRUZXh0dXJlIiwic3ByaXRlIiwiU3ByaXRlIiwidXBkYXRlIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7OztBQUFBLElBQU1BLEtBQUssR0FBR0MsT0FBTyxDQUFDLFNBQUQsQ0FBckI7O0FBRUEsSUFBSUMsUUFBUSxHQUFHLEVBQWY7O0FBQ0EsSUFBSUMsV0FBVyxHQUFHLENBQUMsQ0FBbkI7O0FBRUEsSUFBSUMsY0FBYyxHQUFHLENBQXJCO0FBQ0EsSUFBSUMsWUFBWSxHQUFHLElBQW5CO0FBQ0EsSUFBSUMsYUFBYSxHQUFHLEdBQXBCO0FBQ0EsSUFBSUMsZ0JBQWdCLEdBQUcsSUFBdkI7QUFFQSxJQUFJQyxVQUFVLEdBQUcsSUFBakI7O0FBRUEsU0FBU0MsUUFBVCxHQUFxQjtBQUNqQixNQUFJQyxLQUFLLEdBQUdSLFFBQVEsQ0FBQyxFQUFFQyxXQUFILENBQXBCOztBQUNBLE1BQUksQ0FBQ08sS0FBTCxFQUFZO0FBQ1JBLElBQUFBLEtBQUssR0FBRyxJQUFJVixLQUFKLENBQVVLLFlBQVYsRUFBd0JBLFlBQXhCLENBQVI7O0FBQ0FILElBQUFBLFFBQVEsQ0FBQ1MsSUFBVCxDQUFjRCxLQUFkO0FBQ0g7O0FBQ0QsU0FBT0EsS0FBUDtBQUNIOztBQUVELFNBQVNFLGVBQVQsR0FBNEI7QUFDeEJDLEVBQUFBLG1CQUFtQixDQUFDQyxLQUFwQjtBQUNIOztBQUVELElBQUlDLFFBQVEsR0FBRyxLQUFmO0FBRUE7Ozs7OztBQUtBLElBQUlGLG1CQUFtQixHQUFHO0FBQ3RCYixFQUFBQSxLQUFLLEVBQUVBLEtBRGU7O0FBR3RCOzs7Ozs7QUFNQSxNQUFJZ0IsT0FBSixHQUFlO0FBQ1gsV0FBT0QsUUFBUDtBQUNILEdBWHFCOztBQVl0QixNQUFJQyxPQUFKLENBQWFDLEtBQWIsRUFBb0I7QUFDaEIsUUFBSUYsUUFBUSxLQUFLRSxLQUFqQixFQUF3Qjs7QUFFeEIsUUFBSUEsS0FBSixFQUFXO0FBQ1AsV0FBS0gsS0FBTDtBQUNBSSxNQUFBQSxFQUFFLENBQUNDLFFBQUgsQ0FBWUMsRUFBWixDQUFlRixFQUFFLENBQUNHLFFBQUgsQ0FBWUMseUJBQTNCLEVBQXNEVixlQUF0RDtBQUNILEtBSEQsTUFJSztBQUNETSxNQUFBQSxFQUFFLENBQUNDLFFBQUgsQ0FBWUksR0FBWixDQUFnQkwsRUFBRSxDQUFDRyxRQUFILENBQVlDLHlCQUE1QixFQUF1RFYsZUFBdkQ7QUFDSDs7QUFFREcsSUFBQUEsUUFBUSxHQUFHRSxLQUFYO0FBQ0gsR0F4QnFCOztBQTBCdEI7Ozs7OztBQU1BLE1BQUlPLGFBQUosR0FBcUI7QUFDakIsV0FBT3BCLGNBQVA7QUFDSCxHQWxDcUI7O0FBbUN0QixNQUFJb0IsYUFBSixDQUFtQlAsS0FBbkIsRUFBMEI7QUFDdEJiLElBQUFBLGNBQWMsR0FBR2EsS0FBakI7QUFDSCxHQXJDcUI7O0FBdUN0Qjs7Ozs7O0FBTUEsTUFBSVEsZUFBSixHQUF1QjtBQUNuQixXQUFPbEIsZ0JBQVA7QUFDSCxHQS9DcUI7O0FBaUR0QixNQUFJa0IsZUFBSixDQUFxQkMsTUFBckIsRUFBNkI7QUFDekJuQixJQUFBQSxnQkFBZ0IsR0FBR21CLE1BQW5CO0FBQ0gsR0FuRHFCOztBQXFEdEI7Ozs7OztBQU1BLE1BQUlDLFdBQUosR0FBbUI7QUFDZixXQUFPdEIsWUFBUDtBQUNILEdBN0RxQjs7QUE4RHRCLE1BQUlzQixXQUFKLENBQWlCVixLQUFqQixFQUF3QjtBQUNwQlosSUFBQUEsWUFBWSxHQUFHWSxLQUFmO0FBQ0gsR0FoRXFCOztBQWtFdEI7Ozs7OztBQU1BLE1BQUlXLFlBQUosR0FBb0I7QUFDaEIsV0FBT3RCLGFBQVA7QUFDSCxHQTFFcUI7O0FBMkV0QixNQUFJc0IsWUFBSixDQUFrQlgsS0FBbEIsRUFBeUI7QUFDckJYLElBQUFBLGFBQWEsR0FBR1csS0FBaEI7QUFDSCxHQTdFcUI7O0FBK0V0Qjs7Ozs7Ozs7QUFRQTs7Ozs7O0FBTUFZLEVBQUFBLGlCQTdGc0IsNkJBNkZIQyxXQTdGRyxFQTZGVTtBQUM1QixRQUFJQyxTQUFKLEVBQWUsT0FBTyxJQUFQO0FBQ2YsUUFBSSxDQUFDaEIsUUFBRCxJQUFhWixXQUFXLEtBQUtDLGNBQTdCLElBQ0EsQ0FBQzBCLFdBREQsSUFDZ0JBLFdBQVcsQ0FBQ0UsU0FEaEMsRUFDMkMsT0FBTyxJQUFQO0FBRTNDLFFBQUksQ0FBQ0YsV0FBVyxDQUFDRyxRQUFaLENBQXFCQyxRQUExQixFQUFvQyxPQUFPLElBQVA7QUFFcEMsUUFBSXhCLEtBQUssR0FBR1IsUUFBUSxDQUFDQyxXQUFELENBQXBCOztBQUNBLFFBQUksQ0FBQ08sS0FBTCxFQUFZO0FBQ1JBLE1BQUFBLEtBQUssR0FBR0QsUUFBUSxFQUFoQjtBQUNIOztBQUVELFFBQUkwQixLQUFLLEdBQUd6QixLQUFLLENBQUNtQixpQkFBTixDQUF3QkMsV0FBeEIsQ0FBWjs7QUFDQSxRQUFJLENBQUNLLEtBQUQsSUFBVWhDLFdBQVcsS0FBS0MsY0FBOUIsRUFBOEM7QUFDMUNNLE1BQUFBLEtBQUssR0FBR0QsUUFBUSxFQUFoQjtBQUNBLGFBQU9DLEtBQUssQ0FBQ21CLGlCQUFOLENBQXdCQyxXQUF4QixDQUFQO0FBQ0g7O0FBQ0QsV0FBT0ssS0FBUDtBQUNILEdBL0dxQjs7QUFpSHRCOzs7OztBQUtBckIsRUFBQUEsS0F0SHNCLG1CQXNIYjtBQUNMLFNBQUssSUFBSXNCLENBQUMsR0FBRyxDQUFSLEVBQVdDLENBQUMsR0FBR25DLFFBQVEsQ0FBQ29DLE1BQTdCLEVBQXFDRixDQUFDLEdBQUdDLENBQXpDLEVBQTRDRCxDQUFDLEVBQTdDLEVBQWlEO0FBQzdDbEMsTUFBQUEsUUFBUSxDQUFDa0MsQ0FBRCxDQUFSLENBQVlHLE9BQVo7QUFDSDs7QUFDRHJDLElBQUFBLFFBQVEsQ0FBQ29DLE1BQVQsR0FBa0IsQ0FBbEI7QUFDQW5DLElBQUFBLFdBQVcsR0FBRyxDQUFDLENBQWY7QUFDSCxHQTVIcUI7QUE4SHRCcUMsRUFBQUEsc0JBOUhzQixrQ0E4SEVWLFdBOUhGLEVBOEhlO0FBQ2pDLFFBQUksQ0FBQ0EsV0FBVyxDQUFDRSxTQUFqQixFQUE0QjtBQUU1QixRQUFJUyxPQUFPLEdBQUdYLFdBQVcsQ0FBQ0UsU0FBWixDQUFzQkMsUUFBcEM7QUFDQSxTQUFLUyxrQkFBTCxDQUF3QkQsT0FBeEI7QUFDSCxHQW5JcUI7QUFxSXRCQyxFQUFBQSxrQkFySXNCLDhCQXFJRkQsT0FySUUsRUFxSU87QUFDekIsUUFBSUEsT0FBSixFQUFhO0FBQ1QsV0FBSyxJQUFJTCxDQUFDLEdBQUdsQyxRQUFRLENBQUNvQyxNQUFULEdBQWtCLENBQS9CLEVBQWtDRixDQUFDLElBQUksQ0FBdkMsRUFBMENBLENBQUMsRUFBM0MsRUFBK0M7QUFDM0NsQyxRQUFBQSxRQUFRLENBQUNrQyxDQUFELENBQVIsQ0FBWU8sa0JBQVosQ0FBK0JGLE9BQS9COztBQUVBLFlBQUl2QyxRQUFRLENBQUNrQyxDQUFELENBQVIsQ0FBWVEsT0FBWixFQUFKLEVBQTJCO0FBQ3ZCMUMsVUFBQUEsUUFBUSxDQUFDa0MsQ0FBRCxDQUFSLENBQVlHLE9BQVo7O0FBQ0FyQyxVQUFBQSxRQUFRLENBQUMyQyxNQUFULENBQWdCVCxDQUFoQixFQUFtQixDQUFuQjs7QUFDQWpDLFVBQUFBLFdBQVc7QUFDZDtBQUNKO0FBQ0o7QUFDSixHQWpKcUI7O0FBbUp0Qjs7Ozs7O0FBTUEyQyxFQUFBQSxTQUFTLEVBQUVDLE1BQU0sSUFBSSxVQUFVQyxJQUFWLEVBQWdCO0FBQ2pDLFFBQUlBLElBQUosRUFBVTtBQUNOLFVBQUksQ0FBQ3hDLFVBQUQsSUFBZSxDQUFDQSxVQUFVLENBQUN5QyxPQUEvQixFQUF3QztBQUNwQyxZQUFJQyxLQUFLLEdBQUdoQyxFQUFFLENBQUNpQyxXQUFILENBQWVELEtBQTNCO0FBQ0EsWUFBSUUsTUFBTSxHQUFHbEMsRUFBRSxDQUFDaUMsV0FBSCxDQUFlQyxNQUE1QjtBQUVBNUMsUUFBQUEsVUFBVSxHQUFHLElBQUlVLEVBQUUsQ0FBQ21DLElBQVAsQ0FBWSwwQkFBWixDQUFiO0FBQ0E3QyxRQUFBQSxVQUFVLENBQUMwQyxLQUFYLEdBQW1CQSxLQUFuQjtBQUNBMUMsUUFBQUEsVUFBVSxDQUFDNEMsTUFBWCxHQUFvQkEsTUFBcEI7QUFDQTVDLFFBQUFBLFVBQVUsQ0FBQzhDLENBQVgsR0FBZUosS0FBSyxHQUFDLENBQXJCO0FBQ0ExQyxRQUFBQSxVQUFVLENBQUMrQyxDQUFYLEdBQWVILE1BQU0sR0FBQyxDQUF0QjtBQUNBNUMsUUFBQUEsVUFBVSxDQUFDZ0QsTUFBWCxHQUFvQnRDLEVBQUUsQ0FBQ3VDLEtBQUgsQ0FBU0MsVUFBN0I7QUFDQWxELFFBQUFBLFVBQVUsQ0FBQ21ELE1BQVgsR0FBb0J6QyxFQUFFLENBQUNDLFFBQUgsQ0FBWXlDLFFBQVosRUFBcEI7QUFFQXBELFFBQUFBLFVBQVUsQ0FBQ3FELFVBQVgsR0FBd0IzQyxFQUFFLENBQUNtQyxJQUFILENBQVFTLGlCQUFSLENBQTBCQyxLQUFsRDs7QUFDQTdDLFFBQUFBLEVBQUUsQ0FBQzhDLE1BQUgsQ0FBVUMsaUJBQVY7O0FBRUEsWUFBSUMsTUFBTSxHQUFHMUQsVUFBVSxDQUFDMkQsWUFBWCxDQUF3QmpELEVBQUUsQ0FBQ2tELFVBQTNCLENBQWI7O0FBRUEsWUFBSUMsT0FBTyxHQUFHLElBQUluRCxFQUFFLENBQUNtQyxJQUFQLENBQVksU0FBWixDQUFkO0FBQ0EsWUFBSWlCLE1BQU0sR0FBR0QsT0FBTyxDQUFDRixZQUFSLENBQXFCakQsRUFBRSxDQUFDcUQsTUFBeEIsQ0FBYjtBQUNBRCxRQUFBQSxNQUFNLENBQUNFLElBQVAsR0FBY3RELEVBQUUsQ0FBQ3FELE1BQUgsQ0FBVUUsSUFBVixDQUFlQyxRQUE3QjtBQUNBSixRQUFBQSxNQUFNLENBQUNLLFVBQVAsR0FBb0J6RCxFQUFFLENBQUNxRCxNQUFILENBQVVLLFVBQVYsQ0FBcUJDLFNBQXpDO0FBQ0FSLFFBQUFBLE9BQU8sQ0FBQ1YsTUFBUixHQUFpQm5ELFVBQWpCO0FBQ0E2RCxRQUFBQSxPQUFPLENBQUNuQixLQUFSLEdBQWdCN0MsWUFBaEI7QUFDQWdFLFFBQUFBLE9BQU8sQ0FBQ1MsT0FBUixHQUFrQixDQUFsQjtBQUNBVCxRQUFBQSxPQUFPLENBQUNmLENBQVIsR0FBWWpELFlBQVo7QUFFQTZELFFBQUFBLE1BQU0sQ0FBQ0csT0FBUCxHQUFpQkEsT0FBakI7O0FBRUEsYUFBSyxJQUFJakMsQ0FBQyxHQUFHLENBQWIsRUFBZ0JBLENBQUMsSUFBSWpDLFdBQXJCLEVBQWtDaUMsQ0FBQyxFQUFuQyxFQUF1QztBQUNuQyxjQUFJMkMsSUFBSSxHQUFHLElBQUk3RCxFQUFFLENBQUNtQyxJQUFQLENBQVksT0FBWixDQUFYO0FBRUEsY0FBSVosT0FBTyxHQUFHdkMsUUFBUSxDQUFDa0MsQ0FBRCxDQUFSLENBQVlILFFBQTFCO0FBQ0EsY0FBSUgsV0FBVyxHQUFHLElBQUlaLEVBQUUsQ0FBQzhELFdBQVAsRUFBbEI7QUFDQWxELFVBQUFBLFdBQVcsQ0FBQ21ELFVBQVosQ0FBdUIvRSxRQUFRLENBQUNrQyxDQUFELENBQVIsQ0FBWUgsUUFBbkM7QUFFQSxjQUFJaUQsTUFBTSxHQUFHSCxJQUFJLENBQUNaLFlBQUwsQ0FBa0JqRCxFQUFFLENBQUNpRSxNQUFyQixDQUFiO0FBQ0FELFVBQUFBLE1BQU0sQ0FBQ3BELFdBQVAsR0FBcUJBLFdBQXJCO0FBRUFpRCxVQUFBQSxJQUFJLENBQUNwQixNQUFMLEdBQWNVLE9BQWQ7QUFDSDtBQUNKO0FBQ0osS0ExQ0QsTUEyQ0s7QUFDRCxVQUFJN0QsVUFBSixFQUFnQjtBQUNaQSxRQUFBQSxVQUFVLENBQUNtRCxNQUFYLEdBQW9CLElBQXBCO0FBQ0FuRCxRQUFBQSxVQUFVLEdBQUcsSUFBYjtBQUNIO0FBQ0o7QUFDSixHQTNNcUI7QUE2TXRCNEUsRUFBQUEsTUE3TXNCLG9CQTZNWjtBQUNOLFFBQUksQ0FBQyxLQUFLcEUsT0FBVixFQUFtQjs7QUFFbkIsU0FBSyxJQUFJb0IsQ0FBQyxHQUFHLENBQWIsRUFBZ0JBLENBQUMsSUFBSWpDLFdBQXJCLEVBQWtDaUMsQ0FBQyxFQUFuQyxFQUF1QztBQUNuQ2xDLE1BQUFBLFFBQVEsQ0FBQ2tDLENBQUQsQ0FBUixDQUFZZ0QsTUFBWjtBQUNIO0FBQ0o7QUFuTnFCLENBQTFCO0FBc05BOzs7O0FBSUE7Ozs7O0FBSUFDLE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQnBFLEVBQUUsQ0FBQ0wsbUJBQUgsR0FBeUJBLG1CQUExQyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IEF0bGFzID0gcmVxdWlyZSgnLi9hdGxhcycpO1xuXG5sZXQgX2F0bGFzZXMgPSBbXTtcbmxldCBfYXRsYXNJbmRleCA9IC0xO1xuXG5sZXQgX21heEF0bGFzQ291bnQgPSA1O1xubGV0IF90ZXh0dXJlU2l6ZSA9IDIwNDg7XG5sZXQgX21heEZyYW1lU2l6ZSA9IDUxMjtcbmxldCBfdGV4dHVyZUJsZWVkaW5nID0gdHJ1ZTtcblxubGV0IF9kZWJ1Z05vZGUgPSBudWxsO1xuXG5mdW5jdGlvbiBuZXdBdGxhcyAoKSB7XG4gICAgbGV0IGF0bGFzID0gX2F0bGFzZXNbKytfYXRsYXNJbmRleF1cbiAgICBpZiAoIWF0bGFzKSB7XG4gICAgICAgIGF0bGFzID0gbmV3IEF0bGFzKF90ZXh0dXJlU2l6ZSwgX3RleHR1cmVTaXplKTtcbiAgICAgICAgX2F0bGFzZXMucHVzaChhdGxhcyk7XG4gICAgfVxuICAgIHJldHVybiBhdGxhcztcbn1cblxuZnVuY3Rpb24gYmVmb3JlU2NlbmVMb2FkICgpIHtcbiAgICBkeW5hbWljQXRsYXNNYW5hZ2VyLnJlc2V0KCk7XG59XG5cbmxldCBfZW5hYmxlZCA9IGZhbHNlO1xuXG4vKipcbiAqICEjZW4gTWFuYWdlIER5bmFtaWMgQXRsYXMgTWFuYWdlci4gRHluYW1pYyBBdGxhcyBNYW5hZ2VyIGlzIHVzZWQgZm9yIG1lcmdpbmcgdGV4dHVyZXMgYXQgcnVudGltZSwgc2VlIFtEeW5hbWljIEF0bGFzXShodHRwczovL2RvY3MuY29jb3MuY29tL2NyZWF0b3IvbWFudWFsL2VuL2FkdmFuY2VkLXRvcGljcy9keW5hbWljLWF0bGFzLmh0bWwpIGZvciBkZXRhaWxzLlxuICogISN6aCDnrqHnkIbliqjmgIHlm77pm4bjgILliqjmgIHlm77pm4bnlKjkuo7lnKjov5DooYzml7blr7notLTlm77ov5vooYzlkIjlubbvvIzor6bop4EgW+WKqOaAgeWQiOWbvl0oaHR0cHM6Ly9kb2NzLmNvY29zLmNvbS9jcmVhdG9yL21hbnVhbC96aC9hZHZhbmNlZC10b3BpY3MvZHluYW1pYy1hdGxhcy5odG1sKeOAglxuICogQGNsYXNzIER5bmFtaWNBdGxhc01hbmFnZXJcbiAqL1xubGV0IGR5bmFtaWNBdGxhc01hbmFnZXIgPSB7XG4gICAgQXRsYXM6IEF0bGFzLFxuICAgIFxuICAgIC8qKlxuICAgICAqICEjZW4gRW5hYmxlIG9yIGRpc2FibGUgdGhlIGR5bmFtaWMgYXRsYXMsIHNlZSBbRHluYW1pYyBBdGxhc10oaHR0cHM6Ly9kb2NzLmNvY29zLmNvbS9jcmVhdG9yL21hbnVhbC9lbi9hZHZhbmNlZC10b3BpY3MvZHluYW1pYy1hdGxhcy5odG1sKSBmb3IgZGV0YWlscy5cbiAgICAgKiAhI3poIOW8gOWQr+aIluiAheWFs+mXreWKqOaAgeWbvumbhu+8jOivpuingSBb5Yqo5oCB5ZCI5Zu+XShodHRwczovL2RvY3MuY29jb3MuY29tL2NyZWF0b3IvbWFudWFsL3poL2FkdmFuY2VkLXRvcGljcy9keW5hbWljLWF0bGFzLmh0bWwp44CCXG4gICAgICogQHByb3BlcnR5IGVuYWJsZWRcbiAgICAgKiBAdHlwZSB7Qm9vbGVhbn1cbiAgICAgKi9cbiAgICBnZXQgZW5hYmxlZCAoKSB7XG4gICAgICAgIHJldHVybiBfZW5hYmxlZDtcbiAgICB9LFxuICAgIHNldCBlbmFibGVkICh2YWx1ZSkge1xuICAgICAgICBpZiAoX2VuYWJsZWQgPT09IHZhbHVlKSByZXR1cm47XG5cbiAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLnJlc2V0KCk7XG4gICAgICAgICAgICBjYy5kaXJlY3Rvci5vbihjYy5EaXJlY3Rvci5FVkVOVF9CRUZPUkVfU0NFTkVfTEFVTkNILCBiZWZvcmVTY2VuZUxvYWQpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY2MuZGlyZWN0b3Iub2ZmKGNjLkRpcmVjdG9yLkVWRU5UX0JFRk9SRV9TQ0VORV9MQVVOQ0gsIGJlZm9yZVNjZW5lTG9hZCk7XG4gICAgICAgIH1cblxuICAgICAgICBfZW5hYmxlZCA9IHZhbHVlO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiAhI2VuIFRoZSBtYXhpbXVtIG51bWJlciBvZiBhdGxhcyB0aGF0IGNhbiBiZSBjcmVhdGVkLlxuICAgICAqICEjemgg5Y+v5Lul5Yib5bu655qE5pyA5aSn5Zu+6ZuG5pWw6YeP44CCXG4gICAgICogQHByb3BlcnR5IG1heEF0bGFzQ291bnRcbiAgICAgKiBAdHlwZSB7TnVtYmVyfVxuICAgICAqL1xuICAgIGdldCBtYXhBdGxhc0NvdW50ICgpIHtcbiAgICAgICAgcmV0dXJuIF9tYXhBdGxhc0NvdW50O1xuICAgIH0sXG4gICAgc2V0IG1heEF0bGFzQ291bnQgKHZhbHVlKSB7XG4gICAgICAgIF9tYXhBdGxhc0NvdW50ID0gdmFsdWU7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqICEjZW4gSXMgZW5hYmxlIHRleHR1cmVCbGVlZGluZy5cbiAgICAgKiAhI3poIOaYr+WQpuW8gOWQryB0ZXh0dXJlQmxlZWRpbmdcbiAgICAgKiBAcHJvcGVydHkgdGV4dHVyZUJsZWVkaW5nXG4gICAgICogQHR5cGUge0Jvb2xlYW59XG4gICAgICovXG4gICAgZ2V0IHRleHR1cmVCbGVlZGluZyAoKSB7XG4gICAgICAgIHJldHVybiBfdGV4dHVyZUJsZWVkaW5nO1xuICAgIH0sXG5cbiAgICBzZXQgdGV4dHVyZUJsZWVkaW5nIChlbmFibGUpIHtcbiAgICAgICAgX3RleHR1cmVCbGVlZGluZyA9IGVuYWJsZTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogISNlbiBUaGUgc2l6ZSBvZiB0aGUgYXRsYXMgdGhhdCB3YXMgY3JlYXRlZFxuICAgICAqICEjemgg5Yib5bu655qE5Zu+6ZuG55qE5a696auYXG4gICAgICogQHByb3BlcnR5IHRleHR1cmVTaXplXG4gICAgICogQHR5cGUge051bWJlcn1cbiAgICAgKi9cbiAgICBnZXQgdGV4dHVyZVNpemUgKCkge1xuICAgICAgICByZXR1cm4gX3RleHR1cmVTaXplO1xuICAgIH0sXG4gICAgc2V0IHRleHR1cmVTaXplICh2YWx1ZSkge1xuICAgICAgICBfdGV4dHVyZVNpemUgPSB2YWx1ZTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogISNlbiBUaGUgbWF4aW11bSBzaXplIG9mIHRoZSBwaWN0dXJlIHRoYXQgY2FuIGJlIGFkZGVkIHRvIHRoZSBhdGxhcy5cbiAgICAgKiAhI3poIOWPr+S7pea3u+WKoOi/m+WbvumbhueahOWbvueJh+eahOacgOWkp+WwuuWvuOOAglxuICAgICAqIEBwcm9wZXJ0eSBtYXhGcmFtZVNpemVcbiAgICAgKiBAdHlwZSB7TnVtYmVyfVxuICAgICAqL1xuICAgIGdldCBtYXhGcmFtZVNpemUgKCkge1xuICAgICAgICByZXR1cm4gX21heEZyYW1lU2l6ZTtcbiAgICB9LFxuICAgIHNldCBtYXhGcmFtZVNpemUgKHZhbHVlKSB7XG4gICAgICAgIF9tYXhGcmFtZVNpemUgPSB2YWx1ZTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogISNlbiBUaGUgbWluaW11bSBzaXplIG9mIHRoZSBwaWN0dXJlIHRoYXQgY2FuIGJlIGFkZGVkIHRvIHRoZSBhdGxhcy5cbiAgICAgKiAhI3poIOWPr+S7pea3u+WKoOi/m+WbvumbhueahOWbvueJh+eahOacgOWwj+WwuuWvuOOAglxuICAgICAqIEBwcm9wZXJ0eSBtaW5GcmFtZVNpemVcbiAgICAgKiBAdHlwZSB7TnVtYmVyfVxuICAgICAqIEBkZXByZWNhdGVkXG4gICAgICovXG4gICAgXG4gICAgLyoqXG4gICAgICogISNlbiBBcHBlbmQgYSBzcHJpdGUgZnJhbWUgaW50byB0aGUgZHluYW1pYyBhdGxhcy5cbiAgICAgKiAhI3poIOa3u+WKoOeijuWbvui/m+WFpeWKqOaAgeWbvumbhuOAglxuICAgICAqIEBtZXRob2QgaW5zZXJ0U3ByaXRlRnJhbWVcbiAgICAgKiBAcGFyYW0ge1Nwcml0ZUZyYW1lfSBzcHJpdGVGcmFtZSBcbiAgICAgKi9cbiAgICBpbnNlcnRTcHJpdGVGcmFtZSAoc3ByaXRlRnJhbWUpIHtcbiAgICAgICAgaWYgKENDX0VESVRPUikgcmV0dXJuIG51bGw7XG4gICAgICAgIGlmICghX2VuYWJsZWQgfHwgX2F0bGFzSW5kZXggPT09IF9tYXhBdGxhc0NvdW50IHx8XG4gICAgICAgICAgICAhc3ByaXRlRnJhbWUgfHwgc3ByaXRlRnJhbWUuX29yaWdpbmFsKSByZXR1cm4gbnVsbDtcbiAgICAgICAgXG4gICAgICAgIGlmICghc3ByaXRlRnJhbWUuX3RleHR1cmUucGFja2FibGUpIHJldHVybiBudWxsO1xuXG4gICAgICAgIGxldCBhdGxhcyA9IF9hdGxhc2VzW19hdGxhc0luZGV4XTtcbiAgICAgICAgaWYgKCFhdGxhcykge1xuICAgICAgICAgICAgYXRsYXMgPSBuZXdBdGxhcygpO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IGZyYW1lID0gYXRsYXMuaW5zZXJ0U3ByaXRlRnJhbWUoc3ByaXRlRnJhbWUpO1xuICAgICAgICBpZiAoIWZyYW1lICYmIF9hdGxhc0luZGV4ICE9PSBfbWF4QXRsYXNDb3VudCkge1xuICAgICAgICAgICAgYXRsYXMgPSBuZXdBdGxhcygpO1xuICAgICAgICAgICAgcmV0dXJuIGF0bGFzLmluc2VydFNwcml0ZUZyYW1lKHNwcml0ZUZyYW1lKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZnJhbWU7XG4gICAgfSxcblxuICAgIC8qKiBcbiAgICAgKiAhI2VuIFJlc2V0cyBhbGwgZHluYW1pYyBhdGxhcywgYW5kIHRoZSBleGlzdGluZyBvbmVzIHdpbGwgYmUgZGVzdHJveWVkLlxuICAgICAqICEjemgg6YeN572u5omA5pyJ5Yqo5oCB5Zu+6ZuG77yM5bey5pyJ55qE5Yqo5oCB5Zu+6ZuG5Lya6KKr6ZSA5q+B44CCXG4gICAgICogQG1ldGhvZCByZXNldFxuICAgICovXG4gICAgcmVzZXQgKCkge1xuICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IF9hdGxhc2VzLmxlbmd0aDsgaSA8IGw7IGkrKykge1xuICAgICAgICAgICAgX2F0bGFzZXNbaV0uZGVzdHJveSgpO1xuICAgICAgICB9XG4gICAgICAgIF9hdGxhc2VzLmxlbmd0aCA9IDA7XG4gICAgICAgIF9hdGxhc0luZGV4ID0gLTE7XG4gICAgfSxcblxuICAgIGRlbGV0ZUF0bGFzU3ByaXRlRnJhbWUgKHNwcml0ZUZyYW1lKSB7XG4gICAgICAgIGlmICghc3ByaXRlRnJhbWUuX29yaWdpbmFsKSByZXR1cm47XG5cbiAgICAgICAgbGV0IHRleHR1cmUgPSBzcHJpdGVGcmFtZS5fb3JpZ2luYWwuX3RleHR1cmU7XG4gICAgICAgIHRoaXMuZGVsZXRlQXRsYXNUZXh0dXJlKHRleHR1cmUpO1xuICAgIH0sXG5cbiAgICBkZWxldGVBdGxhc1RleHR1cmUgKHRleHR1cmUpIHtcbiAgICAgICAgaWYgKHRleHR1cmUpIHtcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSBfYXRsYXNlcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgICAgICAgICAgIF9hdGxhc2VzW2ldLmRlbGV0ZUlubmVyVGV4dHVyZSh0ZXh0dXJlKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBpZiAoX2F0bGFzZXNbaV0uaXNFbXB0eSgpKSB7XG4gICAgICAgICAgICAgICAgICAgIF9hdGxhc2VzW2ldLmRlc3Ryb3koKTtcbiAgICAgICAgICAgICAgICAgICAgX2F0bGFzZXMuc3BsaWNlKGksIDEpO1xuICAgICAgICAgICAgICAgICAgICBfYXRsYXNJbmRleC0tO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiAhI2VuIERpc3BsYXlzIGFsbCB0aGUgZHluYW1pYyBhdGxhcyBpbiB0aGUgY3VycmVudCBzY2VuZSwgd2hpY2ggeW91IGNhbiB1c2UgdG8gdmlldyB0aGUgY3VycmVudCBhdGxhcyBzdGF0ZS5cbiAgICAgKiAhI3poIOWcqOW9k+WJjeWcuuaZr+S4reaYvuekuuaJgOacieWKqOaAgeWbvumbhu+8jOWPr+S7peeUqOadpeafpeeci+W9k+WJjeeahOWQiOWbvueKtuaAgeOAglxuICAgICAqIEBtZXRob2Qgc2hvd0RlYnVnXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBzaG93XG4gICAgICovXG4gICAgc2hvd0RlYnVnOiBDQ19ERVYgJiYgZnVuY3Rpb24gKHNob3cpIHtcbiAgICAgICAgaWYgKHNob3cpIHtcbiAgICAgICAgICAgIGlmICghX2RlYnVnTm9kZSB8fCAhX2RlYnVnTm9kZS5pc1ZhbGlkKSB7XG4gICAgICAgICAgICAgICAgbGV0IHdpZHRoID0gY2MudmlzaWJsZVJlY3Qud2lkdGg7XG4gICAgICAgICAgICAgICAgbGV0IGhlaWdodCA9IGNjLnZpc2libGVSZWN0LmhlaWdodDtcblxuICAgICAgICAgICAgICAgIF9kZWJ1Z05vZGUgPSBuZXcgY2MuTm9kZSgnRFlOQU1JQ19BVExBU19ERUJVR19OT0RFJyk7XG4gICAgICAgICAgICAgICAgX2RlYnVnTm9kZS53aWR0aCA9IHdpZHRoO1xuICAgICAgICAgICAgICAgIF9kZWJ1Z05vZGUuaGVpZ2h0ID0gaGVpZ2h0O1xuICAgICAgICAgICAgICAgIF9kZWJ1Z05vZGUueCA9IHdpZHRoLzI7XG4gICAgICAgICAgICAgICAgX2RlYnVnTm9kZS55ID0gaGVpZ2h0LzI7XG4gICAgICAgICAgICAgICAgX2RlYnVnTm9kZS56SW5kZXggPSBjYy5tYWNyby5NQVhfWklOREVYO1xuICAgICAgICAgICAgICAgIF9kZWJ1Z05vZGUucGFyZW50ID0gY2MuZGlyZWN0b3IuZ2V0U2NlbmUoKTtcblxuICAgICAgICAgICAgICAgIF9kZWJ1Z05vZGUuZ3JvdXBJbmRleCA9IGNjLk5vZGUuQnVpbHRpbkdyb3VwSW5kZXguREVCVUc7XG4gICAgICAgICAgICAgICAgY2MuQ2FtZXJhLl9zZXR1cERlYnVnQ2FtZXJhKCk7XG5cbiAgICAgICAgICAgICAgICBsZXQgc2Nyb2xsID0gX2RlYnVnTm9kZS5hZGRDb21wb25lbnQoY2MuU2Nyb2xsVmlldyk7XG5cbiAgICAgICAgICAgICAgICBsZXQgY29udGVudCA9IG5ldyBjYy5Ob2RlKCdDT05URU5UJyk7XG4gICAgICAgICAgICAgICAgbGV0IGxheW91dCA9IGNvbnRlbnQuYWRkQ29tcG9uZW50KGNjLkxheW91dCk7XG4gICAgICAgICAgICAgICAgbGF5b3V0LnR5cGUgPSBjYy5MYXlvdXQuVHlwZS5WRVJUSUNBTDtcbiAgICAgICAgICAgICAgICBsYXlvdXQucmVzaXplTW9kZSA9IGNjLkxheW91dC5SZXNpemVNb2RlLkNPTlRBSU5FUjtcbiAgICAgICAgICAgICAgICBjb250ZW50LnBhcmVudCA9IF9kZWJ1Z05vZGU7XG4gICAgICAgICAgICAgICAgY29udGVudC53aWR0aCA9IF90ZXh0dXJlU2l6ZTtcbiAgICAgICAgICAgICAgICBjb250ZW50LmFuY2hvclkgPSAxO1xuICAgICAgICAgICAgICAgIGNvbnRlbnQueCA9IF90ZXh0dXJlU2l6ZTtcblxuICAgICAgICAgICAgICAgIHNjcm9sbC5jb250ZW50ID0gY29udGVudDtcblxuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDw9IF9hdGxhc0luZGV4OyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IG5vZGUgPSBuZXcgY2MuTm9kZSgnQVRMQVMnKTtcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIGxldCB0ZXh0dXJlID0gX2F0bGFzZXNbaV0uX3RleHR1cmU7XG4gICAgICAgICAgICAgICAgICAgIGxldCBzcHJpdGVGcmFtZSA9IG5ldyBjYy5TcHJpdGVGcmFtZSgpO1xuICAgICAgICAgICAgICAgICAgICBzcHJpdGVGcmFtZS5zZXRUZXh0dXJlKF9hdGxhc2VzW2ldLl90ZXh0dXJlKTtcblxuICAgICAgICAgICAgICAgICAgICBsZXQgc3ByaXRlID0gbm9kZS5hZGRDb21wb25lbnQoY2MuU3ByaXRlKTtcbiAgICAgICAgICAgICAgICAgICAgc3ByaXRlLnNwcml0ZUZyYW1lID0gc3ByaXRlRnJhbWU7XG5cbiAgICAgICAgICAgICAgICAgICAgbm9kZS5wYXJlbnQgPSBjb250ZW50O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGlmIChfZGVidWdOb2RlKSB7XG4gICAgICAgICAgICAgICAgX2RlYnVnTm9kZS5wYXJlbnQgPSBudWxsO1xuICAgICAgICAgICAgICAgIF9kZWJ1Z05vZGUgPSBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIHVwZGF0ZSAoKSB7XG4gICAgICAgIGlmICghdGhpcy5lbmFibGVkKSByZXR1cm47XG5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gX2F0bGFzSW5kZXg7IGkrKykge1xuICAgICAgICAgICAgX2F0bGFzZXNbaV0udXBkYXRlKCk7XG4gICAgICAgIH1cbiAgICB9LFxufTtcblxuLyoqXG4gKiBAbW9kdWxlIGNjXG4gKi9cblxuLyoqXG4gKiBAcHJvcGVydHkgZHluYW1pY0F0bGFzTWFuYWdlclxuICogQHR5cGUgRHluYW1pY0F0bGFzTWFuYWdlclxuICovXG5tb2R1bGUuZXhwb3J0cyA9IGNjLmR5bmFtaWNBdGxhc01hbmFnZXIgPSBkeW5hbWljQXRsYXNNYW5hZ2VyOyJdfQ==