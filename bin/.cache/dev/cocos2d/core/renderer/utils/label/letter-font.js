
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'engine-dev/cocos2d/core/renderer/utils/label/letter-font.js';
                    var __require = nodeEnv ? function (request) {
                        return require(request);
                    } : function (request) {
                        return __quick_compile_engine__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_engine__.registerModule(__filename, module);}"use strict";

exports.__esModule = true;
exports["default"] = void 0;

var _bmfont = _interopRequireDefault(require("../../webgl/assemblers/label/2d/bmfont"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

function _inheritsLoose(subClass, superClass) { subClass.prototype = Object.create(superClass.prototype); subClass.prototype.constructor = subClass; subClass.__proto__ = superClass; }

var Label = require('../../../components/CCLabel');

var LabelOutline = require('../../../components/CCLabelOutline');

var textUtils = require('../../../utils/text-utils');

var Component = require('../../../components/CCComponent');

var RenderTexture = require('../../../assets/CCRenderTexture');

var OUTLINE_SUPPORTED = cc.js.isChildClassOf(LabelOutline, Component);

var getFontFamily = require('../utils').getFontFamily;

var shareLabelInfo = require('../utils').shareLabelInfo;

var FontLetterDefinition = cc.BitmapFont.FontLetterDefinition;
var FontAtlas = cc.BitmapFont.FontAtlas;
var WHITE = cc.Color.WHITE;
var space = 0;
var bleed = 2;

var _invisibleAlpha = (1 / 255).toFixed(3);

function LetterTexture(_char, labelInfo) {
  this._texture = null;
  this._labelInfo = labelInfo;
  this._char = _char;
  this._hash = null;
  this._data = null;
  this._canvas = null;
  this._context = null;
  this._width = 0;
  this._height = 0;
  this._offsetY = 0;
  this._hash = _char.charCodeAt(0) + labelInfo.hash;
}

LetterTexture.prototype = {
  constructor: LetterTexture,
  updateRenderData: function updateRenderData() {
    this._updateProperties();

    this._updateTexture();
  },
  _updateProperties: function _updateProperties() {
    this._texture = new cc.Texture2D();
    this._data = Label._canvasPool.get();
    this._canvas = this._data.canvas;
    this._context = this._data.context;
    this._context.font = this._labelInfo.fontDesc;
    var width = textUtils.safeMeasureText(this._context, this._char, this._labelInfo.fontDesc);
    var blank = this._labelInfo.margin * 2 + bleed;
    this._width = parseFloat(width.toFixed(2)) + blank;
    this._height = (1 + textUtils.BASELINE_RATIO) * this._labelInfo.fontSize + blank;
    this._offsetY = -(this._labelInfo.fontSize * textUtils.BASELINE_RATIO) / 2;

    if (this._canvas.width !== this._width) {
      this._canvas.width = this._width;
    }

    if (this._canvas.height !== this._height) {
      this._canvas.height = this._height;
    }

    this._texture.initWithElement(this._canvas);
  },
  _updateTexture: function _updateTexture() {
    var context = this._context;
    var labelInfo = this._labelInfo,
        width = this._canvas.width,
        height = this._canvas.height;
    var startX = width / 2;
    var startY = height / 2 + this._labelInfo.fontSize * textUtils.MIDDLE_RATIO;
    var color = labelInfo.color;
    context.textAlign = 'center';
    context.textBaseline = 'alphabetic';
    context.clearRect(0, 0, width, height); //Add a white background to avoid black edges.

    context.fillStyle = "rgba(" + color.r + ", " + color.g + ", " + color.b + ", " + _invisibleAlpha + ")";
    context.fillRect(0, 0, width, height);
    context.font = labelInfo.fontDesc; //use round for line join to avoid sharp intersect point

    context.lineJoin = 'round';
    context.fillStyle = "rgba(" + color.r + ", " + color.g + ", " + color.b + ", 1)";

    if (labelInfo.isOutlined && labelInfo.margin > 0) {
      var strokeColor = labelInfo.out || WHITE;
      context.strokeStyle = "rgba(" + strokeColor.r + ", " + strokeColor.g + ", " + strokeColor.b + ", 1)";
      context.lineWidth = labelInfo.margin * 2;
      context.strokeText(this._char, startX, startY);
    }

    context.fillText(this._char, startX, startY);

    this._texture.handleLoadedTexture();
  },
  destroy: function destroy() {
    this._texture.destroy();

    this._texture = null;

    Label._canvasPool.put(this._data);
  }
};

function LetterAtlas(width, height) {
  var texture = new RenderTexture();
  texture.initWithSize(width, height);
  texture.update();
  this._fontDefDictionary = new FontAtlas(texture);
  this._x = space;
  this._y = space;
  this._nexty = space;
  this._width = width;
  this._height = height;
  cc.director.on(cc.Director.EVENT_BEFORE_SCENE_LAUNCH, this.beforeSceneLoad, this);
}

cc.js.mixin(LetterAtlas.prototype, {
  insertLetterTexture: function insertLetterTexture(letterTexture) {
    var texture = letterTexture._texture;
    var width = texture.width,
        height = texture.height;

    if (this._x + width + space > this._width) {
      this._x = space;
      this._y = this._nexty;
    }

    if (this._y + height > this._nexty) {
      this._nexty = this._y + height + space;
    }

    if (this._nexty > this._height) {
      return null;
    }

    this._fontDefDictionary._texture.drawTextureAt(texture, this._x, this._y);

    this._dirty = true;
    var letter = new FontLetterDefinition();
    letter.u = this._x + bleed / 2;
    letter.v = this._y + bleed / 2;
    letter.texture = this._fontDefDictionary._texture;
    letter.valid = true;
    letter.w = letterTexture._width - bleed;
    letter.h = letterTexture._height - bleed;
    letter.xAdvance = letter.w;
    letter.offsetY = letterTexture._offsetY;
    this._x += width + space;

    this._fontDefDictionary.addLetterDefinitions(letterTexture._hash, letter);

    return letter;
  },
  update: function update() {
    if (!this._dirty) return;

    this._fontDefDictionary._texture.update();

    this._dirty = false;
  },
  reset: function reset() {
    this._x = space;
    this._y = space;
    this._nexty = space;
    var chars = this._fontDefDictionary._letterDefinitions;

    for (var i = 0, l = chars.length; i < l; i++) {
      var _char2 = chars[i];

      if (!_char2.isValid) {
        continue;
      }

      _char2.destroy();
    }

    this._fontDefDictionary.clear();
  },
  destroy: function destroy() {
    this.reset();

    this._fontDefDictionary._texture.destroy();

    this._fontDefDictionary._texture = null;
  },
  beforeSceneLoad: function beforeSceneLoad() {
    this.clearAllCache();
  },
  clearAllCache: function clearAllCache() {
    this.destroy();
    var texture = new RenderTexture();
    texture.initWithSize(this._width, this._height);
    texture.update();
    this._fontDefDictionary._texture = texture;
  },
  getLetter: function getLetter(key) {
    return this._fontDefDictionary._letterDefinitions[key];
  },
  getTexture: function getTexture() {
    return this._fontDefDictionary.getTexture();
  },
  getLetterDefinitionForChar: function getLetterDefinitionForChar(_char3, labelInfo) {
    var hash = _char3.charCodeAt(0) + labelInfo.hash;
    var letter = this._fontDefDictionary._letterDefinitions[hash];

    if (!letter) {
      var temp = new LetterTexture(_char3, labelInfo);
      temp.updateRenderData();
      letter = this.insertLetterTexture(temp);
      temp.destroy();
    }

    return letter;
  }
});

function computeHash(labelInfo) {
  var hashData = '';
  var color = labelInfo.color.toHEX("#rrggbb");
  var out = '';

  if (labelInfo.isOutlined && labelInfo.margin > 0) {
    out = out + labelInfo.margin + labelInfo.out.toHEX("#rrggbb");
  }

  ;
  return hashData + labelInfo.fontSize + labelInfo.fontFamily + color + out;
}

var _shareAtlas = null;
var _atlasWidth = 2048;
var _atlasHeight = 2048;
var _isBold = false;

var LetterFontAssembler =
/*#__PURE__*/
function (_WebglBmfontAssembler) {
  _inheritsLoose(LetterFontAssembler, _WebglBmfontAssembler);

  function LetterFontAssembler() {
    return _WebglBmfontAssembler.apply(this, arguments) || this;
  }

  var _proto = LetterFontAssembler.prototype;

  _proto._getAssemblerData = function _getAssemblerData() {
    if (!_shareAtlas) {
      _shareAtlas = new LetterAtlas(_atlasWidth, _atlasHeight);
      cc.Label._shareAtlas = _shareAtlas;
    }

    return _shareAtlas.getTexture();
  };

  _proto._updateFontFamily = function _updateFontFamily(comp) {
    shareLabelInfo.fontAtlas = _shareAtlas;
    shareLabelInfo.fontFamily = getFontFamily(comp); // outline

    var outline = OUTLINE_SUPPORTED && comp.getComponent(LabelOutline);

    if (outline && outline.enabled) {
      shareLabelInfo.isOutlined = true;
      shareLabelInfo.margin = outline.width;
      shareLabelInfo.out = outline.color.clone();
      shareLabelInfo.out.a = outline.color.a * comp.node.color.a / 255.0;
    } else {
      shareLabelInfo.isOutlined = false;
      shareLabelInfo.margin = 0;
    }
  };

  _proto._updateLabelInfo = function _updateLabelInfo(comp) {
    shareLabelInfo.fontDesc = this._getFontDesc();
    shareLabelInfo.color = comp.node.color;
    shareLabelInfo.hash = computeHash(shareLabelInfo);
  };

  _proto._getFontDesc = function _getFontDesc() {
    var fontDesc = shareLabelInfo.fontSize.toString() + 'px ';
    fontDesc = fontDesc + shareLabelInfo.fontFamily;

    if (_isBold) {
      fontDesc = "bold " + fontDesc;
    }

    return fontDesc;
  };

  _proto._computeHorizontalKerningForText = function _computeHorizontalKerningForText() {};

  _proto._determineRect = function _determineRect(tempRect) {
    return false;
  };

  return LetterFontAssembler;
}(_bmfont["default"]);

exports["default"] = LetterFontAssembler;
module.exports = exports["default"];
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_engine__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxldHRlci1mb250LmpzIl0sIm5hbWVzIjpbIkxhYmVsIiwicmVxdWlyZSIsIkxhYmVsT3V0bGluZSIsInRleHRVdGlscyIsIkNvbXBvbmVudCIsIlJlbmRlclRleHR1cmUiLCJPVVRMSU5FX1NVUFBPUlRFRCIsImNjIiwianMiLCJpc0NoaWxkQ2xhc3NPZiIsImdldEZvbnRGYW1pbHkiLCJzaGFyZUxhYmVsSW5mbyIsIkZvbnRMZXR0ZXJEZWZpbml0aW9uIiwiQml0bWFwRm9udCIsIkZvbnRBdGxhcyIsIldISVRFIiwiQ29sb3IiLCJzcGFjZSIsImJsZWVkIiwiX2ludmlzaWJsZUFscGhhIiwidG9GaXhlZCIsIkxldHRlclRleHR1cmUiLCJjaGFyIiwibGFiZWxJbmZvIiwiX3RleHR1cmUiLCJfbGFiZWxJbmZvIiwiX2NoYXIiLCJfaGFzaCIsIl9kYXRhIiwiX2NhbnZhcyIsIl9jb250ZXh0IiwiX3dpZHRoIiwiX2hlaWdodCIsIl9vZmZzZXRZIiwiY2hhckNvZGVBdCIsImhhc2giLCJwcm90b3R5cGUiLCJjb25zdHJ1Y3RvciIsInVwZGF0ZVJlbmRlckRhdGEiLCJfdXBkYXRlUHJvcGVydGllcyIsIl91cGRhdGVUZXh0dXJlIiwiVGV4dHVyZTJEIiwiX2NhbnZhc1Bvb2wiLCJnZXQiLCJjYW52YXMiLCJjb250ZXh0IiwiZm9udCIsImZvbnREZXNjIiwid2lkdGgiLCJzYWZlTWVhc3VyZVRleHQiLCJibGFuayIsIm1hcmdpbiIsInBhcnNlRmxvYXQiLCJCQVNFTElORV9SQVRJTyIsImZvbnRTaXplIiwiaGVpZ2h0IiwiaW5pdFdpdGhFbGVtZW50Iiwic3RhcnRYIiwic3RhcnRZIiwiTUlERExFX1JBVElPIiwiY29sb3IiLCJ0ZXh0QWxpZ24iLCJ0ZXh0QmFzZWxpbmUiLCJjbGVhclJlY3QiLCJmaWxsU3R5bGUiLCJyIiwiZyIsImIiLCJmaWxsUmVjdCIsImxpbmVKb2luIiwiaXNPdXRsaW5lZCIsInN0cm9rZUNvbG9yIiwib3V0Iiwic3Ryb2tlU3R5bGUiLCJsaW5lV2lkdGgiLCJzdHJva2VUZXh0IiwiZmlsbFRleHQiLCJoYW5kbGVMb2FkZWRUZXh0dXJlIiwiZGVzdHJveSIsInB1dCIsIkxldHRlckF0bGFzIiwidGV4dHVyZSIsImluaXRXaXRoU2l6ZSIsInVwZGF0ZSIsIl9mb250RGVmRGljdGlvbmFyeSIsIl94IiwiX3kiLCJfbmV4dHkiLCJkaXJlY3RvciIsIm9uIiwiRGlyZWN0b3IiLCJFVkVOVF9CRUZPUkVfU0NFTkVfTEFVTkNIIiwiYmVmb3JlU2NlbmVMb2FkIiwibWl4aW4iLCJpbnNlcnRMZXR0ZXJUZXh0dXJlIiwibGV0dGVyVGV4dHVyZSIsImRyYXdUZXh0dXJlQXQiLCJfZGlydHkiLCJsZXR0ZXIiLCJ1IiwidiIsInZhbGlkIiwidyIsImgiLCJ4QWR2YW5jZSIsIm9mZnNldFkiLCJhZGRMZXR0ZXJEZWZpbml0aW9ucyIsInJlc2V0IiwiY2hhcnMiLCJfbGV0dGVyRGVmaW5pdGlvbnMiLCJpIiwibCIsImxlbmd0aCIsImlzVmFsaWQiLCJjbGVhciIsImNsZWFyQWxsQ2FjaGUiLCJnZXRMZXR0ZXIiLCJrZXkiLCJnZXRUZXh0dXJlIiwiZ2V0TGV0dGVyRGVmaW5pdGlvbkZvckNoYXIiLCJ0ZW1wIiwiY29tcHV0ZUhhc2giLCJoYXNoRGF0YSIsInRvSEVYIiwiZm9udEZhbWlseSIsIl9zaGFyZUF0bGFzIiwiX2F0bGFzV2lkdGgiLCJfYXRsYXNIZWlnaHQiLCJfaXNCb2xkIiwiTGV0dGVyRm9udEFzc2VtYmxlciIsIl9nZXRBc3NlbWJsZXJEYXRhIiwiX3VwZGF0ZUZvbnRGYW1pbHkiLCJjb21wIiwiZm9udEF0bGFzIiwib3V0bGluZSIsImdldENvbXBvbmVudCIsImVuYWJsZWQiLCJjbG9uZSIsImEiLCJub2RlIiwiX3VwZGF0ZUxhYmVsSW5mbyIsIl9nZXRGb250RGVzYyIsInRvU3RyaW5nIiwiX2NvbXB1dGVIb3Jpem9udGFsS2VybmluZ0ZvclRleHQiLCJfZGV0ZXJtaW5lUmVjdCIsInRlbXBSZWN0IiwiV2ViZ2xCbWZvbnRBc3NlbWJsZXIiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7QUF5QkE7Ozs7OztBQUVBLElBQU1BLEtBQUssR0FBR0MsT0FBTyxDQUFDLDZCQUFELENBQXJCOztBQUNBLElBQU1DLFlBQVksR0FBR0QsT0FBTyxDQUFDLG9DQUFELENBQTVCOztBQUNBLElBQU1FLFNBQVMsR0FBR0YsT0FBTyxDQUFDLDJCQUFELENBQXpCOztBQUNBLElBQU1HLFNBQVMsR0FBR0gsT0FBTyxDQUFDLGlDQUFELENBQXpCOztBQUNBLElBQU1JLGFBQWEsR0FBR0osT0FBTyxDQUFDLGlDQUFELENBQTdCOztBQUNBLElBQU1LLGlCQUFpQixHQUFHQyxFQUFFLENBQUNDLEVBQUgsQ0FBTUMsY0FBTixDQUFxQlAsWUFBckIsRUFBbUNFLFNBQW5DLENBQTFCOztBQUNBLElBQU1NLGFBQWEsR0FBR1QsT0FBTyxDQUFDLFVBQUQsQ0FBUCxDQUFvQlMsYUFBMUM7O0FBQ0EsSUFBTUMsY0FBYyxHQUFHVixPQUFPLENBQUMsVUFBRCxDQUFQLENBQW9CVSxjQUEzQzs7QUFHQSxJQUFNQyxvQkFBb0IsR0FBR0wsRUFBRSxDQUFDTSxVQUFILENBQWNELG9CQUEzQztBQUNBLElBQU1FLFNBQVMsR0FBR1AsRUFBRSxDQUFDTSxVQUFILENBQWNDLFNBQWhDO0FBRUEsSUFBTUMsS0FBSyxHQUFHUixFQUFFLENBQUNTLEtBQUgsQ0FBU0QsS0FBdkI7QUFDQSxJQUFNRSxLQUFLLEdBQUcsQ0FBZDtBQUNBLElBQU1DLEtBQUssR0FBRyxDQUFkOztBQUNBLElBQU1DLGVBQWUsR0FBRyxDQUFDLElBQUksR0FBTCxFQUFVQyxPQUFWLENBQWtCLENBQWxCLENBQXhCOztBQUVBLFNBQVNDLGFBQVQsQ0FBdUJDLEtBQXZCLEVBQTZCQyxTQUE3QixFQUF3QztBQUNwQyxPQUFLQyxRQUFMLEdBQWdCLElBQWhCO0FBQ0EsT0FBS0MsVUFBTCxHQUFrQkYsU0FBbEI7QUFDQSxPQUFLRyxLQUFMLEdBQWFKLEtBQWI7QUFDQSxPQUFLSyxLQUFMLEdBQWEsSUFBYjtBQUNBLE9BQUtDLEtBQUwsR0FBYSxJQUFiO0FBQ0EsT0FBS0MsT0FBTCxHQUFlLElBQWY7QUFDQSxPQUFLQyxRQUFMLEdBQWdCLElBQWhCO0FBQ0EsT0FBS0MsTUFBTCxHQUFjLENBQWQ7QUFDQSxPQUFLQyxPQUFMLEdBQWUsQ0FBZjtBQUNBLE9BQUtDLFFBQUwsR0FBZ0IsQ0FBaEI7QUFDQSxPQUFLTixLQUFMLEdBQWFMLEtBQUksQ0FBQ1ksVUFBTCxDQUFnQixDQUFoQixJQUFxQlgsU0FBUyxDQUFDWSxJQUE1QztBQUNIOztBQUVEZCxhQUFhLENBQUNlLFNBQWQsR0FBMEI7QUFDdEJDLEVBQUFBLFdBQVcsRUFBRWhCLGFBRFM7QUFHdEJpQixFQUFBQSxnQkFIc0IsOEJBR0Y7QUFDaEIsU0FBS0MsaUJBQUw7O0FBQ0EsU0FBS0MsY0FBTDtBQUNILEdBTnFCO0FBT3RCRCxFQUFBQSxpQkFQc0IsK0JBT0Q7QUFDakIsU0FBS2YsUUFBTCxHQUFnQixJQUFJakIsRUFBRSxDQUFDa0MsU0FBUCxFQUFoQjtBQUNBLFNBQUtiLEtBQUwsR0FBYTVCLEtBQUssQ0FBQzBDLFdBQU4sQ0FBa0JDLEdBQWxCLEVBQWI7QUFDQSxTQUFLZCxPQUFMLEdBQWUsS0FBS0QsS0FBTCxDQUFXZ0IsTUFBMUI7QUFDQSxTQUFLZCxRQUFMLEdBQWdCLEtBQUtGLEtBQUwsQ0FBV2lCLE9BQTNCO0FBQ0EsU0FBS2YsUUFBTCxDQUFjZ0IsSUFBZCxHQUFxQixLQUFLckIsVUFBTCxDQUFnQnNCLFFBQXJDO0FBQ0EsUUFBSUMsS0FBSyxHQUFHN0MsU0FBUyxDQUFDOEMsZUFBVixDQUEwQixLQUFLbkIsUUFBL0IsRUFBeUMsS0FBS0osS0FBOUMsRUFBcUQsS0FBS0QsVUFBTCxDQUFnQnNCLFFBQXJFLENBQVo7QUFDQSxRQUFJRyxLQUFLLEdBQUcsS0FBS3pCLFVBQUwsQ0FBZ0IwQixNQUFoQixHQUF5QixDQUF6QixHQUE2QmpDLEtBQXpDO0FBQ0EsU0FBS2EsTUFBTCxHQUFjcUIsVUFBVSxDQUFDSixLQUFLLENBQUM1QixPQUFOLENBQWMsQ0FBZCxDQUFELENBQVYsR0FBK0I4QixLQUE3QztBQUNBLFNBQUtsQixPQUFMLEdBQWUsQ0FBQyxJQUFJN0IsU0FBUyxDQUFDa0QsY0FBZixJQUFpQyxLQUFLNUIsVUFBTCxDQUFnQjZCLFFBQWpELEdBQTRESixLQUEzRTtBQUNBLFNBQUtqQixRQUFMLEdBQWdCLEVBQUcsS0FBS1IsVUFBTCxDQUFnQjZCLFFBQWhCLEdBQTJCbkQsU0FBUyxDQUFDa0QsY0FBeEMsSUFBMEQsQ0FBMUU7O0FBRUEsUUFBSSxLQUFLeEIsT0FBTCxDQUFhbUIsS0FBYixLQUF1QixLQUFLakIsTUFBaEMsRUFBd0M7QUFDcEMsV0FBS0YsT0FBTCxDQUFhbUIsS0FBYixHQUFxQixLQUFLakIsTUFBMUI7QUFDSDs7QUFFRCxRQUFJLEtBQUtGLE9BQUwsQ0FBYTBCLE1BQWIsS0FBd0IsS0FBS3ZCLE9BQWpDLEVBQTBDO0FBQ3RDLFdBQUtILE9BQUwsQ0FBYTBCLE1BQWIsR0FBc0IsS0FBS3ZCLE9BQTNCO0FBQ0g7O0FBRUQsU0FBS1IsUUFBTCxDQUFjZ0MsZUFBZCxDQUE4QixLQUFLM0IsT0FBbkM7QUFDSCxHQTVCcUI7QUE2QnRCVyxFQUFBQSxjQTdCc0IsNEJBNkJKO0FBQ2QsUUFBSUssT0FBTyxHQUFHLEtBQUtmLFFBQW5CO0FBQ0EsUUFBSVAsU0FBUyxHQUFHLEtBQUtFLFVBQXJCO0FBQUEsUUFDSXVCLEtBQUssR0FBRyxLQUFLbkIsT0FBTCxDQUFhbUIsS0FEekI7QUFBQSxRQUVJTyxNQUFNLEdBQUcsS0FBSzFCLE9BQUwsQ0FBYTBCLE1BRjFCO0FBSUEsUUFBSUUsTUFBTSxHQUFHVCxLQUFLLEdBQUcsQ0FBckI7QUFDQSxRQUFJVSxNQUFNLEdBQUdILE1BQU0sR0FBRyxDQUFULEdBQWEsS0FBSzlCLFVBQUwsQ0FBZ0I2QixRQUFoQixHQUEyQm5ELFNBQVMsQ0FBQ3dELFlBQS9EO0FBQ0EsUUFBSUMsS0FBSyxHQUFHckMsU0FBUyxDQUFDcUMsS0FBdEI7QUFFQWYsSUFBQUEsT0FBTyxDQUFDZ0IsU0FBUixHQUFvQixRQUFwQjtBQUNBaEIsSUFBQUEsT0FBTyxDQUFDaUIsWUFBUixHQUF1QixZQUF2QjtBQUNBakIsSUFBQUEsT0FBTyxDQUFDa0IsU0FBUixDQUFrQixDQUFsQixFQUFxQixDQUFyQixFQUF3QmYsS0FBeEIsRUFBK0JPLE1BQS9CLEVBWmMsQ0FhZDs7QUFDQVYsSUFBQUEsT0FBTyxDQUFDbUIsU0FBUixhQUE0QkosS0FBSyxDQUFDSyxDQUFsQyxVQUF3Q0wsS0FBSyxDQUFDTSxDQUE5QyxVQUFvRE4sS0FBSyxDQUFDTyxDQUExRCxVQUFnRWhELGVBQWhFO0FBQ0EwQixJQUFBQSxPQUFPLENBQUN1QixRQUFSLENBQWlCLENBQWpCLEVBQW9CLENBQXBCLEVBQXVCcEIsS0FBdkIsRUFBOEJPLE1BQTlCO0FBQ0FWLElBQUFBLE9BQU8sQ0FBQ0MsSUFBUixHQUFldkIsU0FBUyxDQUFDd0IsUUFBekIsQ0FoQmMsQ0FrQmQ7O0FBQ0FGLElBQUFBLE9BQU8sQ0FBQ3dCLFFBQVIsR0FBbUIsT0FBbkI7QUFDQXhCLElBQUFBLE9BQU8sQ0FBQ21CLFNBQVIsYUFBNEJKLEtBQUssQ0FBQ0ssQ0FBbEMsVUFBd0NMLEtBQUssQ0FBQ00sQ0FBOUMsVUFBb0ROLEtBQUssQ0FBQ08sQ0FBMUQ7O0FBQ0EsUUFBSTVDLFNBQVMsQ0FBQytDLFVBQVYsSUFBd0IvQyxTQUFTLENBQUM0QixNQUFWLEdBQW1CLENBQS9DLEVBQWtEO0FBQzlDLFVBQUlvQixXQUFXLEdBQUdoRCxTQUFTLENBQUNpRCxHQUFWLElBQWlCekQsS0FBbkM7QUFDQThCLE1BQUFBLE9BQU8sQ0FBQzRCLFdBQVIsYUFBOEJGLFdBQVcsQ0FBQ04sQ0FBMUMsVUFBZ0RNLFdBQVcsQ0FBQ0wsQ0FBNUQsVUFBa0VLLFdBQVcsQ0FBQ0osQ0FBOUU7QUFDQXRCLE1BQUFBLE9BQU8sQ0FBQzZCLFNBQVIsR0FBb0JuRCxTQUFTLENBQUM0QixNQUFWLEdBQW1CLENBQXZDO0FBQ0FOLE1BQUFBLE9BQU8sQ0FBQzhCLFVBQVIsQ0FBbUIsS0FBS2pELEtBQXhCLEVBQStCK0IsTUFBL0IsRUFBdUNDLE1BQXZDO0FBQ0g7O0FBQ0RiLElBQUFBLE9BQU8sQ0FBQytCLFFBQVIsQ0FBaUIsS0FBS2xELEtBQXRCLEVBQTZCK0IsTUFBN0IsRUFBcUNDLE1BQXJDOztBQUVBLFNBQUtsQyxRQUFMLENBQWNxRCxtQkFBZDtBQUNILEdBM0RxQjtBQTZEdEJDLEVBQUFBLE9BN0RzQixxQkE2RFg7QUFDUCxTQUFLdEQsUUFBTCxDQUFjc0QsT0FBZDs7QUFDQSxTQUFLdEQsUUFBTCxHQUFnQixJQUFoQjs7QUFDQXhCLElBQUFBLEtBQUssQ0FBQzBDLFdBQU4sQ0FBa0JxQyxHQUFsQixDQUFzQixLQUFLbkQsS0FBM0I7QUFDSDtBQWpFcUIsQ0FBMUI7O0FBb0VBLFNBQVNvRCxXQUFULENBQXNCaEMsS0FBdEIsRUFBNkJPLE1BQTdCLEVBQXFDO0FBQ2pDLE1BQUkwQixPQUFPLEdBQUcsSUFBSTVFLGFBQUosRUFBZDtBQUNBNEUsRUFBQUEsT0FBTyxDQUFDQyxZQUFSLENBQXFCbEMsS0FBckIsRUFBNEJPLE1BQTVCO0FBQ0EwQixFQUFBQSxPQUFPLENBQUNFLE1BQVI7QUFFQSxPQUFLQyxrQkFBTCxHQUEwQixJQUFJdEUsU0FBSixDQUFjbUUsT0FBZCxDQUExQjtBQUVBLE9BQUtJLEVBQUwsR0FBVXBFLEtBQVY7QUFDQSxPQUFLcUUsRUFBTCxHQUFVckUsS0FBVjtBQUNBLE9BQUtzRSxNQUFMLEdBQWN0RSxLQUFkO0FBRUEsT0FBS2MsTUFBTCxHQUFjaUIsS0FBZDtBQUNBLE9BQUtoQixPQUFMLEdBQWV1QixNQUFmO0FBRUFoRCxFQUFBQSxFQUFFLENBQUNpRixRQUFILENBQVlDLEVBQVosQ0FBZWxGLEVBQUUsQ0FBQ21GLFFBQUgsQ0FBWUMseUJBQTNCLEVBQXNELEtBQUtDLGVBQTNELEVBQTRFLElBQTVFO0FBQ0g7O0FBRURyRixFQUFFLENBQUNDLEVBQUgsQ0FBTXFGLEtBQU4sQ0FBWWIsV0FBVyxDQUFDNUMsU0FBeEIsRUFBbUM7QUFDL0IwRCxFQUFBQSxtQkFEK0IsK0JBQ1ZDLGFBRFUsRUFDSztBQUNoQyxRQUFJZCxPQUFPLEdBQUdjLGFBQWEsQ0FBQ3ZFLFFBQTVCO0FBQ0EsUUFBSXdCLEtBQUssR0FBR2lDLE9BQU8sQ0FBQ2pDLEtBQXBCO0FBQUEsUUFBMkJPLE1BQU0sR0FBRzBCLE9BQU8sQ0FBQzFCLE1BQTVDOztBQUVBLFFBQUssS0FBSzhCLEVBQUwsR0FBVXJDLEtBQVYsR0FBa0IvQixLQUFuQixHQUE0QixLQUFLYyxNQUFyQyxFQUE2QztBQUN6QyxXQUFLc0QsRUFBTCxHQUFVcEUsS0FBVjtBQUNBLFdBQUtxRSxFQUFMLEdBQVUsS0FBS0MsTUFBZjtBQUNIOztBQUVELFFBQUssS0FBS0QsRUFBTCxHQUFVL0IsTUFBWCxHQUFxQixLQUFLZ0MsTUFBOUIsRUFBc0M7QUFDbEMsV0FBS0EsTUFBTCxHQUFjLEtBQUtELEVBQUwsR0FBVS9CLE1BQVYsR0FBbUJ0QyxLQUFqQztBQUNIOztBQUVELFFBQUksS0FBS3NFLE1BQUwsR0FBYyxLQUFLdkQsT0FBdkIsRUFBZ0M7QUFDNUIsYUFBTyxJQUFQO0FBQ0g7O0FBRUQsU0FBS29ELGtCQUFMLENBQXdCNUQsUUFBeEIsQ0FBaUN3RSxhQUFqQyxDQUErQ2YsT0FBL0MsRUFBd0QsS0FBS0ksRUFBN0QsRUFBaUUsS0FBS0MsRUFBdEU7O0FBRUEsU0FBS1csTUFBTCxHQUFjLElBQWQ7QUFFQSxRQUFJQyxNQUFNLEdBQUcsSUFBSXRGLG9CQUFKLEVBQWI7QUFDQXNGLElBQUFBLE1BQU0sQ0FBQ0MsQ0FBUCxHQUFXLEtBQUtkLEVBQUwsR0FBVW5FLEtBQUssR0FBQyxDQUEzQjtBQUNBZ0YsSUFBQUEsTUFBTSxDQUFDRSxDQUFQLEdBQVcsS0FBS2QsRUFBTCxHQUFVcEUsS0FBSyxHQUFDLENBQTNCO0FBQ0FnRixJQUFBQSxNQUFNLENBQUNqQixPQUFQLEdBQWlCLEtBQUtHLGtCQUFMLENBQXdCNUQsUUFBekM7QUFDQTBFLElBQUFBLE1BQU0sQ0FBQ0csS0FBUCxHQUFlLElBQWY7QUFDQUgsSUFBQUEsTUFBTSxDQUFDSSxDQUFQLEdBQVdQLGFBQWEsQ0FBQ2hFLE1BQWQsR0FBdUJiLEtBQWxDO0FBQ0FnRixJQUFBQSxNQUFNLENBQUNLLENBQVAsR0FBV1IsYUFBYSxDQUFDL0QsT0FBZCxHQUF3QmQsS0FBbkM7QUFDQWdGLElBQUFBLE1BQU0sQ0FBQ00sUUFBUCxHQUFrQk4sTUFBTSxDQUFDSSxDQUF6QjtBQUNBSixJQUFBQSxNQUFNLENBQUNPLE9BQVAsR0FBaUJWLGFBQWEsQ0FBQzlELFFBQS9CO0FBRUEsU0FBS29ELEVBQUwsSUFBV3JDLEtBQUssR0FBRy9CLEtBQW5COztBQUVBLFNBQUttRSxrQkFBTCxDQUF3QnNCLG9CQUF4QixDQUE2Q1gsYUFBYSxDQUFDcEUsS0FBM0QsRUFBa0V1RSxNQUFsRTs7QUFFQSxXQUFPQSxNQUFQO0FBQ0gsR0FyQzhCO0FBdUMvQmYsRUFBQUEsTUF2QytCLG9CQXVDckI7QUFDTixRQUFJLENBQUMsS0FBS2MsTUFBVixFQUFrQjs7QUFDbEIsU0FBS2Isa0JBQUwsQ0FBd0I1RCxRQUF4QixDQUFpQzJELE1BQWpDOztBQUNBLFNBQUtjLE1BQUwsR0FBYyxLQUFkO0FBQ0gsR0EzQzhCO0FBNkMvQlUsRUFBQUEsS0E3QytCLG1CQTZDdEI7QUFDTCxTQUFLdEIsRUFBTCxHQUFVcEUsS0FBVjtBQUNBLFNBQUtxRSxFQUFMLEdBQVVyRSxLQUFWO0FBQ0EsU0FBS3NFLE1BQUwsR0FBY3RFLEtBQWQ7QUFFQSxRQUFJMkYsS0FBSyxHQUFHLEtBQUt4QixrQkFBTCxDQUF3QnlCLGtCQUFwQzs7QUFDQSxTQUFLLElBQUlDLENBQUMsR0FBRyxDQUFSLEVBQVdDLENBQUMsR0FBR0gsS0FBSyxDQUFDSSxNQUExQixFQUFrQ0YsQ0FBQyxHQUFHQyxDQUF0QyxFQUF5Q0QsQ0FBQyxFQUExQyxFQUE4QztBQUMxQyxVQUFJeEYsTUFBSSxHQUFHc0YsS0FBSyxDQUFDRSxDQUFELENBQWhCOztBQUNBLFVBQUksQ0FBQ3hGLE1BQUksQ0FBQzJGLE9BQVYsRUFBbUI7QUFDZjtBQUNIOztBQUNEM0YsTUFBQUEsTUFBSSxDQUFDd0QsT0FBTDtBQUNIOztBQUVELFNBQUtNLGtCQUFMLENBQXdCOEIsS0FBeEI7QUFDSCxHQTVEOEI7QUE4RC9CcEMsRUFBQUEsT0E5RCtCLHFCQThEcEI7QUFDUCxTQUFLNkIsS0FBTDs7QUFDQSxTQUFLdkIsa0JBQUwsQ0FBd0I1RCxRQUF4QixDQUFpQ3NELE9BQWpDOztBQUNBLFNBQUtNLGtCQUFMLENBQXdCNUQsUUFBeEIsR0FBbUMsSUFBbkM7QUFDSCxHQWxFOEI7QUFvRS9Cb0UsRUFBQUEsZUFwRStCLDZCQW9FWjtBQUNmLFNBQUt1QixhQUFMO0FBQ0gsR0F0RThCO0FBd0UvQkEsRUFBQUEsYUF4RStCLDJCQXdFZDtBQUNiLFNBQUtyQyxPQUFMO0FBRUEsUUFBSUcsT0FBTyxHQUFHLElBQUk1RSxhQUFKLEVBQWQ7QUFDQTRFLElBQUFBLE9BQU8sQ0FBQ0MsWUFBUixDQUFxQixLQUFLbkQsTUFBMUIsRUFBa0MsS0FBS0MsT0FBdkM7QUFDQWlELElBQUFBLE9BQU8sQ0FBQ0UsTUFBUjtBQUVBLFNBQUtDLGtCQUFMLENBQXdCNUQsUUFBeEIsR0FBbUN5RCxPQUFuQztBQUNILEdBaEY4QjtBQWtGL0JtQyxFQUFBQSxTQWxGK0IscUJBa0ZwQkMsR0FsRm9CLEVBa0ZmO0FBQ1osV0FBTyxLQUFLakMsa0JBQUwsQ0FBd0J5QixrQkFBeEIsQ0FBMkNRLEdBQTNDLENBQVA7QUFDSCxHQXBGOEI7QUFzRi9CQyxFQUFBQSxVQXRGK0Isd0JBc0ZqQjtBQUNWLFdBQU8sS0FBS2xDLGtCQUFMLENBQXdCa0MsVUFBeEIsRUFBUDtBQUNILEdBeEY4QjtBQTBGL0JDLEVBQUFBLDBCQUEwQixFQUFFLG9DQUFTakcsTUFBVCxFQUFlQyxTQUFmLEVBQTBCO0FBQ2xELFFBQUlZLElBQUksR0FBR2IsTUFBSSxDQUFDWSxVQUFMLENBQWdCLENBQWhCLElBQXFCWCxTQUFTLENBQUNZLElBQTFDO0FBQ0EsUUFBSStELE1BQU0sR0FBRyxLQUFLZCxrQkFBTCxDQUF3QnlCLGtCQUF4QixDQUEyQzFFLElBQTNDLENBQWI7O0FBQ0EsUUFBSSxDQUFDK0QsTUFBTCxFQUFhO0FBQ1QsVUFBSXNCLElBQUksR0FBRyxJQUFJbkcsYUFBSixDQUFrQkMsTUFBbEIsRUFBd0JDLFNBQXhCLENBQVg7QUFDQWlHLE1BQUFBLElBQUksQ0FBQ2xGLGdCQUFMO0FBQ0E0RCxNQUFBQSxNQUFNLEdBQUcsS0FBS0osbUJBQUwsQ0FBeUIwQixJQUF6QixDQUFUO0FBQ0FBLE1BQUFBLElBQUksQ0FBQzFDLE9BQUw7QUFDSDs7QUFFRCxXQUFPb0IsTUFBUDtBQUNIO0FBckc4QixDQUFuQzs7QUF3R0EsU0FBU3VCLFdBQVQsQ0FBc0JsRyxTQUF0QixFQUFpQztBQUM3QixNQUFJbUcsUUFBUSxHQUFHLEVBQWY7QUFDQSxNQUFJOUQsS0FBSyxHQUFHckMsU0FBUyxDQUFDcUMsS0FBVixDQUFnQitELEtBQWhCLENBQXNCLFNBQXRCLENBQVo7QUFDQSxNQUFJbkQsR0FBRyxHQUFHLEVBQVY7O0FBQ0EsTUFBSWpELFNBQVMsQ0FBQytDLFVBQVYsSUFBd0IvQyxTQUFTLENBQUM0QixNQUFWLEdBQW1CLENBQS9DLEVBQWtEO0FBQzlDcUIsSUFBQUEsR0FBRyxHQUFHQSxHQUFHLEdBQUdqRCxTQUFTLENBQUM0QixNQUFoQixHQUF5QjVCLFNBQVMsQ0FBQ2lELEdBQVYsQ0FBY21ELEtBQWQsQ0FBb0IsU0FBcEIsQ0FBL0I7QUFDSDs7QUFBQTtBQUVELFNBQU9ELFFBQVEsR0FBR25HLFNBQVMsQ0FBQytCLFFBQXJCLEdBQWdDL0IsU0FBUyxDQUFDcUcsVUFBMUMsR0FBdURoRSxLQUF2RCxHQUErRFksR0FBdEU7QUFDSDs7QUFFRCxJQUFJcUQsV0FBVyxHQUFHLElBQWxCO0FBRUEsSUFBSUMsV0FBVyxHQUFHLElBQWxCO0FBQ0EsSUFBSUMsWUFBWSxHQUFHLElBQW5CO0FBQ0EsSUFBSUMsT0FBTyxHQUFHLEtBQWQ7O0lBRXFCQzs7Ozs7Ozs7Ozs7U0FDakJDLG9CQUFBLDZCQUFxQjtBQUNqQixRQUFJLENBQUNMLFdBQUwsRUFBa0I7QUFDZEEsTUFBQUEsV0FBVyxHQUFHLElBQUk3QyxXQUFKLENBQWdCOEMsV0FBaEIsRUFBNkJDLFlBQTdCLENBQWQ7QUFDQXhILE1BQUFBLEVBQUUsQ0FBQ1AsS0FBSCxDQUFTNkgsV0FBVCxHQUF1QkEsV0FBdkI7QUFDSDs7QUFFRCxXQUFPQSxXQUFXLENBQUNQLFVBQVosRUFBUDtBQUNIOztTQUVEYSxvQkFBQSwyQkFBbUJDLElBQW5CLEVBQXlCO0FBQ3JCekgsSUFBQUEsY0FBYyxDQUFDMEgsU0FBZixHQUEyQlIsV0FBM0I7QUFDQWxILElBQUFBLGNBQWMsQ0FBQ2lILFVBQWYsR0FBNEJsSCxhQUFhLENBQUMwSCxJQUFELENBQXpDLENBRnFCLENBSXJCOztBQUNBLFFBQUlFLE9BQU8sR0FBR2hJLGlCQUFpQixJQUFJOEgsSUFBSSxDQUFDRyxZQUFMLENBQWtCckksWUFBbEIsQ0FBbkM7O0FBQ0EsUUFBSW9JLE9BQU8sSUFBSUEsT0FBTyxDQUFDRSxPQUF2QixFQUFnQztBQUM1QjdILE1BQUFBLGNBQWMsQ0FBQzJELFVBQWYsR0FBNEIsSUFBNUI7QUFDQTNELE1BQUFBLGNBQWMsQ0FBQ3dDLE1BQWYsR0FBd0JtRixPQUFPLENBQUN0RixLQUFoQztBQUNBckMsTUFBQUEsY0FBYyxDQUFDNkQsR0FBZixHQUFxQjhELE9BQU8sQ0FBQzFFLEtBQVIsQ0FBYzZFLEtBQWQsRUFBckI7QUFDQTlILE1BQUFBLGNBQWMsQ0FBQzZELEdBQWYsQ0FBbUJrRSxDQUFuQixHQUF1QkosT0FBTyxDQUFDMUUsS0FBUixDQUFjOEUsQ0FBZCxHQUFrQk4sSUFBSSxDQUFDTyxJQUFMLENBQVUvRSxLQUFWLENBQWdCOEUsQ0FBbEMsR0FBc0MsS0FBN0Q7QUFDSCxLQUxELE1BTUs7QUFDRC9ILE1BQUFBLGNBQWMsQ0FBQzJELFVBQWYsR0FBNEIsS0FBNUI7QUFDQTNELE1BQUFBLGNBQWMsQ0FBQ3dDLE1BQWYsR0FBd0IsQ0FBeEI7QUFDSDtBQUNKOztTQUVEeUYsbUJBQUEsMEJBQWtCUixJQUFsQixFQUF3QjtBQUNwQnpILElBQUFBLGNBQWMsQ0FBQ29DLFFBQWYsR0FBMEIsS0FBSzhGLFlBQUwsRUFBMUI7QUFDQWxJLElBQUFBLGNBQWMsQ0FBQ2lELEtBQWYsR0FBdUJ3RSxJQUFJLENBQUNPLElBQUwsQ0FBVS9FLEtBQWpDO0FBQ0FqRCxJQUFBQSxjQUFjLENBQUN3QixJQUFmLEdBQXNCc0YsV0FBVyxDQUFDOUcsY0FBRCxDQUFqQztBQUNIOztTQUVEa0ksZUFBQSx3QkFBZ0I7QUFDWixRQUFJOUYsUUFBUSxHQUFHcEMsY0FBYyxDQUFDMkMsUUFBZixDQUF3QndGLFFBQXhCLEtBQXFDLEtBQXBEO0FBQ0EvRixJQUFBQSxRQUFRLEdBQUdBLFFBQVEsR0FBR3BDLGNBQWMsQ0FBQ2lILFVBQXJDOztBQUNBLFFBQUlJLE9BQUosRUFBYTtBQUNUakYsTUFBQUEsUUFBUSxHQUFHLFVBQVVBLFFBQXJCO0FBQ0g7O0FBRUQsV0FBT0EsUUFBUDtBQUNIOztTQUNEZ0csbUNBQUEsNENBQW9DLENBQUU7O1NBQ3RDQyxpQkFBQSx3QkFBZ0JDLFFBQWhCLEVBQTBCO0FBQ3RCLFdBQU8sS0FBUDtBQUNIOzs7RUE5QzRDQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gQ29weXJpZ2h0IChjKSAyMDE4IFhpYW1lbiBZYWppIFNvZnR3YXJlIENvLiwgTHRkLlxuXG4gaHR0cHM6Ly93d3cuY29jb3MuY29tL1xuXG4gUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weVxuIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZW5naW5lIHNvdXJjZSBjb2RlICh0aGUgXCJTb2Z0d2FyZVwiKSwgYSBsaW1pdGVkLFxuIHdvcmxkd2lkZSwgcm95YWx0eS1mcmVlLCBub24tYXNzaWduYWJsZSwgcmV2b2NhYmxlIGFuZCBub24tZXhjbHVzaXZlIGxpY2Vuc2VcbiB0byB1c2UgQ29jb3MgQ3JlYXRvciBzb2xlbHkgdG8gZGV2ZWxvcCBnYW1lcyBvbiB5b3VyIHRhcmdldCBwbGF0Zm9ybXMuIFlvdSBzaGFsbFxuIG5vdCB1c2UgQ29jb3MgQ3JlYXRvciBzb2Z0d2FyZSBmb3IgZGV2ZWxvcGluZyBvdGhlciBzb2Z0d2FyZSBvciB0b29scyB0aGF0J3NcbiB1c2VkIGZvciBkZXZlbG9waW5nIGdhbWVzLiBZb3UgYXJlIG5vdCBncmFudGVkIHRvIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsXG4gc3VibGljZW5zZSwgYW5kL29yIHNlbGwgY29waWVzIG9mIENvY29zIENyZWF0b3IuXG5cbiBUaGUgc29mdHdhcmUgb3IgdG9vbHMgaW4gdGhpcyBMaWNlbnNlIEFncmVlbWVudCBhcmUgbGljZW5zZWQsIG5vdCBzb2xkLlxuIFhpYW1lbiBZYWppIFNvZnR3YXJlIENvLiwgTHRkLiByZXNlcnZlcyBhbGwgcmlnaHRzIG5vdCBleHByZXNzbHkgZ3JhbnRlZCB0byB5b3UuXG5cbiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SXG4gSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXG4gRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFXG4gQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUlxuIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXG4gT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTlxuIFRIRSBTT0ZUV0FSRS5cbiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuXG5pbXBvcnQgV2ViZ2xCbWZvbnRBc3NlbWJsZXIgZnJvbSAnLi4vLi4vd2ViZ2wvYXNzZW1ibGVycy9sYWJlbC8yZC9ibWZvbnQnO1xuXG5jb25zdCBMYWJlbCA9IHJlcXVpcmUoJy4uLy4uLy4uL2NvbXBvbmVudHMvQ0NMYWJlbCcpO1xuY29uc3QgTGFiZWxPdXRsaW5lID0gcmVxdWlyZSgnLi4vLi4vLi4vY29tcG9uZW50cy9DQ0xhYmVsT3V0bGluZScpO1xuY29uc3QgdGV4dFV0aWxzID0gcmVxdWlyZSgnLi4vLi4vLi4vdXRpbHMvdGV4dC11dGlscycpO1xuY29uc3QgQ29tcG9uZW50ID0gcmVxdWlyZSgnLi4vLi4vLi4vY29tcG9uZW50cy9DQ0NvbXBvbmVudCcpO1xuY29uc3QgUmVuZGVyVGV4dHVyZSA9IHJlcXVpcmUoJy4uLy4uLy4uL2Fzc2V0cy9DQ1JlbmRlclRleHR1cmUnKTtcbmNvbnN0IE9VVExJTkVfU1VQUE9SVEVEID0gY2MuanMuaXNDaGlsZENsYXNzT2YoTGFiZWxPdXRsaW5lLCBDb21wb25lbnQpO1xuY29uc3QgZ2V0Rm9udEZhbWlseSA9IHJlcXVpcmUoJy4uL3V0aWxzJykuZ2V0Rm9udEZhbWlseTtcbmNvbnN0IHNoYXJlTGFiZWxJbmZvID0gcmVxdWlyZSgnLi4vdXRpbHMnKS5zaGFyZUxhYmVsSW5mbztcblxuXG5jb25zdCBGb250TGV0dGVyRGVmaW5pdGlvbiA9IGNjLkJpdG1hcEZvbnQuRm9udExldHRlckRlZmluaXRpb247XG5jb25zdCBGb250QXRsYXMgPSBjYy5CaXRtYXBGb250LkZvbnRBdGxhcztcblxuY29uc3QgV0hJVEUgPSBjYy5Db2xvci5XSElURTtcbmNvbnN0IHNwYWNlID0gMDtcbmNvbnN0IGJsZWVkID0gMjtcbmNvbnN0IF9pbnZpc2libGVBbHBoYSA9ICgxIC8gMjU1KS50b0ZpeGVkKDMpO1xuXG5mdW5jdGlvbiBMZXR0ZXJUZXh0dXJlKGNoYXIsIGxhYmVsSW5mbykge1xuICAgIHRoaXMuX3RleHR1cmUgPSBudWxsO1xuICAgIHRoaXMuX2xhYmVsSW5mbyA9IGxhYmVsSW5mbztcbiAgICB0aGlzLl9jaGFyID0gY2hhcjtcbiAgICB0aGlzLl9oYXNoID0gbnVsbDtcbiAgICB0aGlzLl9kYXRhID0gbnVsbDtcbiAgICB0aGlzLl9jYW52YXMgPSBudWxsO1xuICAgIHRoaXMuX2NvbnRleHQgPSBudWxsO1xuICAgIHRoaXMuX3dpZHRoID0gMDtcbiAgICB0aGlzLl9oZWlnaHQgPSAwO1xuICAgIHRoaXMuX29mZnNldFkgPSAwO1xuICAgIHRoaXMuX2hhc2ggPSBjaGFyLmNoYXJDb2RlQXQoMCkgKyBsYWJlbEluZm8uaGFzaDtcbn1cblxuTGV0dGVyVGV4dHVyZS5wcm90b3R5cGUgPSB7XG4gICAgY29uc3RydWN0b3I6IExldHRlclRleHR1cmUsXG5cbiAgICB1cGRhdGVSZW5kZXJEYXRhICgpIHtcbiAgICAgICAgdGhpcy5fdXBkYXRlUHJvcGVydGllcygpO1xuICAgICAgICB0aGlzLl91cGRhdGVUZXh0dXJlKCk7XG4gICAgfSxcbiAgICBfdXBkYXRlUHJvcGVydGllcyAoKSB7XG4gICAgICAgIHRoaXMuX3RleHR1cmUgPSBuZXcgY2MuVGV4dHVyZTJEKCk7XG4gICAgICAgIHRoaXMuX2RhdGEgPSBMYWJlbC5fY2FudmFzUG9vbC5nZXQoKTtcbiAgICAgICAgdGhpcy5fY2FudmFzID0gdGhpcy5fZGF0YS5jYW52YXM7XG4gICAgICAgIHRoaXMuX2NvbnRleHQgPSB0aGlzLl9kYXRhLmNvbnRleHQ7XG4gICAgICAgIHRoaXMuX2NvbnRleHQuZm9udCA9IHRoaXMuX2xhYmVsSW5mby5mb250RGVzYztcbiAgICAgICAgbGV0IHdpZHRoID0gdGV4dFV0aWxzLnNhZmVNZWFzdXJlVGV4dCh0aGlzLl9jb250ZXh0LCB0aGlzLl9jaGFyLCB0aGlzLl9sYWJlbEluZm8uZm9udERlc2MpO1xuICAgICAgICBsZXQgYmxhbmsgPSB0aGlzLl9sYWJlbEluZm8ubWFyZ2luICogMiArIGJsZWVkO1xuICAgICAgICB0aGlzLl93aWR0aCA9IHBhcnNlRmxvYXQod2lkdGgudG9GaXhlZCgyKSkgKyBibGFuaztcbiAgICAgICAgdGhpcy5faGVpZ2h0ID0gKDEgKyB0ZXh0VXRpbHMuQkFTRUxJTkVfUkFUSU8pICogdGhpcy5fbGFiZWxJbmZvLmZvbnRTaXplICsgYmxhbms7XG4gICAgICAgIHRoaXMuX29mZnNldFkgPSAtICh0aGlzLl9sYWJlbEluZm8uZm9udFNpemUgKiB0ZXh0VXRpbHMuQkFTRUxJTkVfUkFUSU8pIC8gMjtcblxuICAgICAgICBpZiAodGhpcy5fY2FudmFzLndpZHRoICE9PSB0aGlzLl93aWR0aCkge1xuICAgICAgICAgICAgdGhpcy5fY2FudmFzLndpZHRoID0gdGhpcy5fd2lkdGg7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5fY2FudmFzLmhlaWdodCAhPT0gdGhpcy5faGVpZ2h0KSB7XG4gICAgICAgICAgICB0aGlzLl9jYW52YXMuaGVpZ2h0ID0gdGhpcy5faGVpZ2h0O1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5fdGV4dHVyZS5pbml0V2l0aEVsZW1lbnQodGhpcy5fY2FudmFzKTtcbiAgICB9LFxuICAgIF91cGRhdGVUZXh0dXJlICgpIHtcbiAgICAgICAgbGV0IGNvbnRleHQgPSB0aGlzLl9jb250ZXh0O1xuICAgICAgICBsZXQgbGFiZWxJbmZvID0gdGhpcy5fbGFiZWxJbmZvLFxuICAgICAgICAgICAgd2lkdGggPSB0aGlzLl9jYW52YXMud2lkdGgsXG4gICAgICAgICAgICBoZWlnaHQgPSB0aGlzLl9jYW52YXMuaGVpZ2h0O1xuXG4gICAgICAgIGxldCBzdGFydFggPSB3aWR0aCAvIDI7XG4gICAgICAgIGxldCBzdGFydFkgPSBoZWlnaHQgLyAyICsgdGhpcy5fbGFiZWxJbmZvLmZvbnRTaXplICogdGV4dFV0aWxzLk1JRERMRV9SQVRJTztcbiAgICAgICAgbGV0IGNvbG9yID0gbGFiZWxJbmZvLmNvbG9yO1xuXG4gICAgICAgIGNvbnRleHQudGV4dEFsaWduID0gJ2NlbnRlcic7XG4gICAgICAgIGNvbnRleHQudGV4dEJhc2VsaW5lID0gJ2FscGhhYmV0aWMnO1xuICAgICAgICBjb250ZXh0LmNsZWFyUmVjdCgwLCAwLCB3aWR0aCwgaGVpZ2h0KTtcbiAgICAgICAgLy9BZGQgYSB3aGl0ZSBiYWNrZ3JvdW5kIHRvIGF2b2lkIGJsYWNrIGVkZ2VzLlxuICAgICAgICBjb250ZXh0LmZpbGxTdHlsZSA9IGByZ2JhKCR7Y29sb3Iucn0sICR7Y29sb3IuZ30sICR7Y29sb3IuYn0sICR7X2ludmlzaWJsZUFscGhhfSlgO1xuICAgICAgICBjb250ZXh0LmZpbGxSZWN0KDAsIDAsIHdpZHRoLCBoZWlnaHQpO1xuICAgICAgICBjb250ZXh0LmZvbnQgPSBsYWJlbEluZm8uZm9udERlc2M7XG5cbiAgICAgICAgLy91c2Ugcm91bmQgZm9yIGxpbmUgam9pbiB0byBhdm9pZCBzaGFycCBpbnRlcnNlY3QgcG9pbnRcbiAgICAgICAgY29udGV4dC5saW5lSm9pbiA9ICdyb3VuZCc7XG4gICAgICAgIGNvbnRleHQuZmlsbFN0eWxlID0gYHJnYmEoJHtjb2xvci5yfSwgJHtjb2xvci5nfSwgJHtjb2xvci5ifSwgMSlgO1xuICAgICAgICBpZiAobGFiZWxJbmZvLmlzT3V0bGluZWQgJiYgbGFiZWxJbmZvLm1hcmdpbiA+IDApIHtcbiAgICAgICAgICAgIGxldCBzdHJva2VDb2xvciA9IGxhYmVsSW5mby5vdXQgfHwgV0hJVEU7XG4gICAgICAgICAgICBjb250ZXh0LnN0cm9rZVN0eWxlID0gYHJnYmEoJHtzdHJva2VDb2xvci5yfSwgJHtzdHJva2VDb2xvci5nfSwgJHtzdHJva2VDb2xvci5ifSwgMSlgO1xuICAgICAgICAgICAgY29udGV4dC5saW5lV2lkdGggPSBsYWJlbEluZm8ubWFyZ2luICogMjtcbiAgICAgICAgICAgIGNvbnRleHQuc3Ryb2tlVGV4dCh0aGlzLl9jaGFyLCBzdGFydFgsIHN0YXJ0WSk7XG4gICAgICAgIH1cbiAgICAgICAgY29udGV4dC5maWxsVGV4dCh0aGlzLl9jaGFyLCBzdGFydFgsIHN0YXJ0WSk7XG5cbiAgICAgICAgdGhpcy5fdGV4dHVyZS5oYW5kbGVMb2FkZWRUZXh0dXJlKCk7XG4gICAgfSxcblxuICAgIGRlc3Ryb3kgKCkge1xuICAgICAgICB0aGlzLl90ZXh0dXJlLmRlc3Ryb3koKTtcbiAgICAgICAgdGhpcy5fdGV4dHVyZSA9IG51bGw7XG4gICAgICAgIExhYmVsLl9jYW52YXNQb29sLnB1dCh0aGlzLl9kYXRhKTtcbiAgICB9LFxufVxuXG5mdW5jdGlvbiBMZXR0ZXJBdGxhcyAod2lkdGgsIGhlaWdodCkge1xuICAgIGxldCB0ZXh0dXJlID0gbmV3IFJlbmRlclRleHR1cmUoKTtcbiAgICB0ZXh0dXJlLmluaXRXaXRoU2l6ZSh3aWR0aCwgaGVpZ2h0KTtcbiAgICB0ZXh0dXJlLnVwZGF0ZSgpO1xuXG4gICAgdGhpcy5fZm9udERlZkRpY3Rpb25hcnkgPSBuZXcgRm9udEF0bGFzKHRleHR1cmUpO1xuICAgIFxuICAgIHRoaXMuX3ggPSBzcGFjZTtcbiAgICB0aGlzLl95ID0gc3BhY2U7XG4gICAgdGhpcy5fbmV4dHkgPSBzcGFjZTtcblxuICAgIHRoaXMuX3dpZHRoID0gd2lkdGg7XG4gICAgdGhpcy5faGVpZ2h0ID0gaGVpZ2h0O1xuXG4gICAgY2MuZGlyZWN0b3Iub24oY2MuRGlyZWN0b3IuRVZFTlRfQkVGT1JFX1NDRU5FX0xBVU5DSCwgdGhpcy5iZWZvcmVTY2VuZUxvYWQsIHRoaXMpO1xufVxuXG5jYy5qcy5taXhpbihMZXR0ZXJBdGxhcy5wcm90b3R5cGUsIHtcbiAgICBpbnNlcnRMZXR0ZXJUZXh0dXJlIChsZXR0ZXJUZXh0dXJlKSB7XG4gICAgICAgIGxldCB0ZXh0dXJlID0gbGV0dGVyVGV4dHVyZS5fdGV4dHVyZTtcbiAgICAgICAgbGV0IHdpZHRoID0gdGV4dHVyZS53aWR0aCwgaGVpZ2h0ID0gdGV4dHVyZS5oZWlnaHQ7ICAgICAgICBcblxuICAgICAgICBpZiAoKHRoaXMuX3ggKyB3aWR0aCArIHNwYWNlKSA+IHRoaXMuX3dpZHRoKSB7XG4gICAgICAgICAgICB0aGlzLl94ID0gc3BhY2U7XG4gICAgICAgICAgICB0aGlzLl95ID0gdGhpcy5fbmV4dHk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoKHRoaXMuX3kgKyBoZWlnaHQpID4gdGhpcy5fbmV4dHkpIHtcbiAgICAgICAgICAgIHRoaXMuX25leHR5ID0gdGhpcy5feSArIGhlaWdodCArIHNwYWNlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuX25leHR5ID4gdGhpcy5faGVpZ2h0KSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuX2ZvbnREZWZEaWN0aW9uYXJ5Ll90ZXh0dXJlLmRyYXdUZXh0dXJlQXQodGV4dHVyZSwgdGhpcy5feCwgdGhpcy5feSk7XG5cbiAgICAgICAgdGhpcy5fZGlydHkgPSB0cnVlO1xuICAgICAgICBcbiAgICAgICAgbGV0IGxldHRlciA9IG5ldyBGb250TGV0dGVyRGVmaW5pdGlvbigpO1xuICAgICAgICBsZXR0ZXIudSA9IHRoaXMuX3ggKyBibGVlZC8yO1xuICAgICAgICBsZXR0ZXIudiA9IHRoaXMuX3kgKyBibGVlZC8yO1xuICAgICAgICBsZXR0ZXIudGV4dHVyZSA9IHRoaXMuX2ZvbnREZWZEaWN0aW9uYXJ5Ll90ZXh0dXJlO1xuICAgICAgICBsZXR0ZXIudmFsaWQgPSB0cnVlO1xuICAgICAgICBsZXR0ZXIudyA9IGxldHRlclRleHR1cmUuX3dpZHRoIC0gYmxlZWQ7XG4gICAgICAgIGxldHRlci5oID0gbGV0dGVyVGV4dHVyZS5faGVpZ2h0IC0gYmxlZWQ7XG4gICAgICAgIGxldHRlci54QWR2YW5jZSA9IGxldHRlci53O1xuICAgICAgICBsZXR0ZXIub2Zmc2V0WSA9IGxldHRlclRleHR1cmUuX29mZnNldFk7XG5cbiAgICAgICAgdGhpcy5feCArPSB3aWR0aCArIHNwYWNlO1xuXG4gICAgICAgIHRoaXMuX2ZvbnREZWZEaWN0aW9uYXJ5LmFkZExldHRlckRlZmluaXRpb25zKGxldHRlclRleHR1cmUuX2hhc2gsIGxldHRlcik7XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gbGV0dGVyXG4gICAgfSxcblxuICAgIHVwZGF0ZSAoKSB7XG4gICAgICAgIGlmICghdGhpcy5fZGlydHkpIHJldHVybjtcbiAgICAgICAgdGhpcy5fZm9udERlZkRpY3Rpb25hcnkuX3RleHR1cmUudXBkYXRlKCk7XG4gICAgICAgIHRoaXMuX2RpcnR5ID0gZmFsc2U7XG4gICAgfSxcblxuICAgIHJlc2V0ICgpIHtcbiAgICAgICAgdGhpcy5feCA9IHNwYWNlO1xuICAgICAgICB0aGlzLl95ID0gc3BhY2U7XG4gICAgICAgIHRoaXMuX25leHR5ID0gc3BhY2U7XG5cbiAgICAgICAgbGV0IGNoYXJzID0gdGhpcy5fZm9udERlZkRpY3Rpb25hcnkuX2xldHRlckRlZmluaXRpb25zO1xuICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IGNoYXJzLmxlbmd0aDsgaSA8IGw7IGkrKykge1xuICAgICAgICAgICAgbGV0IGNoYXIgPSBjaGFyc1tpXTtcbiAgICAgICAgICAgIGlmICghY2hhci5pc1ZhbGlkKSB7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjaGFyLmRlc3Ryb3koKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuX2ZvbnREZWZEaWN0aW9uYXJ5LmNsZWFyKCk7XG4gICAgfSxcblxuICAgIGRlc3Ryb3kgKCkge1xuICAgICAgICB0aGlzLnJlc2V0KCk7XG4gICAgICAgIHRoaXMuX2ZvbnREZWZEaWN0aW9uYXJ5Ll90ZXh0dXJlLmRlc3Ryb3koKTtcbiAgICAgICAgdGhpcy5fZm9udERlZkRpY3Rpb25hcnkuX3RleHR1cmUgPSBudWxsO1xuICAgIH0sXG5cbiAgICBiZWZvcmVTY2VuZUxvYWQgKCkge1xuICAgICAgICB0aGlzLmNsZWFyQWxsQ2FjaGUoKTtcbiAgICB9LFxuXG4gICAgY2xlYXJBbGxDYWNoZSAoKSB7XG4gICAgICAgIHRoaXMuZGVzdHJveSgpO1xuXG4gICAgICAgIGxldCB0ZXh0dXJlID0gbmV3IFJlbmRlclRleHR1cmUoKTtcbiAgICAgICAgdGV4dHVyZS5pbml0V2l0aFNpemUodGhpcy5fd2lkdGgsIHRoaXMuX2hlaWdodCk7XG4gICAgICAgIHRleHR1cmUudXBkYXRlKCk7XG4gICAgICAgIFxuICAgICAgICB0aGlzLl9mb250RGVmRGljdGlvbmFyeS5fdGV4dHVyZSA9IHRleHR1cmU7XG4gICAgfSxcblxuICAgIGdldExldHRlciAoa2V5KSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9mb250RGVmRGljdGlvbmFyeS5fbGV0dGVyRGVmaW5pdGlvbnNba2V5XTtcbiAgICB9LFxuXG4gICAgZ2V0VGV4dHVyZSAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9mb250RGVmRGljdGlvbmFyeS5nZXRUZXh0dXJlKCk7XG4gICAgfSxcblxuICAgIGdldExldHRlckRlZmluaXRpb25Gb3JDaGFyOiBmdW5jdGlvbihjaGFyLCBsYWJlbEluZm8pIHtcbiAgICAgICAgbGV0IGhhc2ggPSBjaGFyLmNoYXJDb2RlQXQoMCkgKyBsYWJlbEluZm8uaGFzaDtcbiAgICAgICAgbGV0IGxldHRlciA9IHRoaXMuX2ZvbnREZWZEaWN0aW9uYXJ5Ll9sZXR0ZXJEZWZpbml0aW9uc1toYXNoXTtcbiAgICAgICAgaWYgKCFsZXR0ZXIpIHtcbiAgICAgICAgICAgIGxldCB0ZW1wID0gbmV3IExldHRlclRleHR1cmUoY2hhciwgbGFiZWxJbmZvKTtcbiAgICAgICAgICAgIHRlbXAudXBkYXRlUmVuZGVyRGF0YSgpO1xuICAgICAgICAgICAgbGV0dGVyID0gdGhpcy5pbnNlcnRMZXR0ZXJUZXh0dXJlKHRlbXApO1xuICAgICAgICAgICAgdGVtcC5kZXN0cm95KCk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbGV0dGVyO1xuICAgIH1cbn0pO1xuXG5mdW5jdGlvbiBjb21wdXRlSGFzaCAobGFiZWxJbmZvKSB7XG4gICAgbGV0IGhhc2hEYXRhID0gJyc7XG4gICAgbGV0IGNvbG9yID0gbGFiZWxJbmZvLmNvbG9yLnRvSEVYKFwiI3JyZ2diYlwiKTtcbiAgICBsZXQgb3V0ID0gJyc7XG4gICAgaWYgKGxhYmVsSW5mby5pc091dGxpbmVkICYmIGxhYmVsSW5mby5tYXJnaW4gPiAwKSB7XG4gICAgICAgIG91dCA9IG91dCArIGxhYmVsSW5mby5tYXJnaW4gKyBsYWJlbEluZm8ub3V0LnRvSEVYKFwiI3JyZ2diYlwiKTtcbiAgICB9O1xuICAgIFxuICAgIHJldHVybiBoYXNoRGF0YSArIGxhYmVsSW5mby5mb250U2l6ZSArIGxhYmVsSW5mby5mb250RmFtaWx5ICsgY29sb3IgKyBvdXQ7XG59XG5cbmxldCBfc2hhcmVBdGxhcyA9IG51bGw7XG5cbmxldCBfYXRsYXNXaWR0aCA9IDIwNDg7XG5sZXQgX2F0bGFzSGVpZ2h0ID0gMjA0ODtcbmxldCBfaXNCb2xkID0gZmFsc2U7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIExldHRlckZvbnRBc3NlbWJsZXIgZXh0ZW5kcyBXZWJnbEJtZm9udEFzc2VtYmxlciB7XG4gICAgX2dldEFzc2VtYmxlckRhdGEgKCkge1xuICAgICAgICBpZiAoIV9zaGFyZUF0bGFzKSB7XG4gICAgICAgICAgICBfc2hhcmVBdGxhcyA9IG5ldyBMZXR0ZXJBdGxhcyhfYXRsYXNXaWR0aCwgX2F0bGFzSGVpZ2h0KTtcbiAgICAgICAgICAgIGNjLkxhYmVsLl9zaGFyZUF0bGFzID0gX3NoYXJlQXRsYXM7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHJldHVybiBfc2hhcmVBdGxhcy5nZXRUZXh0dXJlKCk7XG4gICAgfVxuXG4gICAgX3VwZGF0ZUZvbnRGYW1pbHkgKGNvbXApIHtcbiAgICAgICAgc2hhcmVMYWJlbEluZm8uZm9udEF0bGFzID0gX3NoYXJlQXRsYXM7XG4gICAgICAgIHNoYXJlTGFiZWxJbmZvLmZvbnRGYW1pbHkgPSBnZXRGb250RmFtaWx5KGNvbXApO1xuXG4gICAgICAgIC8vIG91dGxpbmVcbiAgICAgICAgbGV0IG91dGxpbmUgPSBPVVRMSU5FX1NVUFBPUlRFRCAmJiBjb21wLmdldENvbXBvbmVudChMYWJlbE91dGxpbmUpO1xuICAgICAgICBpZiAob3V0bGluZSAmJiBvdXRsaW5lLmVuYWJsZWQpIHtcbiAgICAgICAgICAgIHNoYXJlTGFiZWxJbmZvLmlzT3V0bGluZWQgPSB0cnVlO1xuICAgICAgICAgICAgc2hhcmVMYWJlbEluZm8ubWFyZ2luID0gb3V0bGluZS53aWR0aDtcbiAgICAgICAgICAgIHNoYXJlTGFiZWxJbmZvLm91dCA9IG91dGxpbmUuY29sb3IuY2xvbmUoKTtcbiAgICAgICAgICAgIHNoYXJlTGFiZWxJbmZvLm91dC5hID0gb3V0bGluZS5jb2xvci5hICogY29tcC5ub2RlLmNvbG9yLmEgLyAyNTUuMDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHNoYXJlTGFiZWxJbmZvLmlzT3V0bGluZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIHNoYXJlTGFiZWxJbmZvLm1hcmdpbiA9IDA7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBfdXBkYXRlTGFiZWxJbmZvIChjb21wKSB7XG4gICAgICAgIHNoYXJlTGFiZWxJbmZvLmZvbnREZXNjID0gdGhpcy5fZ2V0Rm9udERlc2MoKTtcbiAgICAgICAgc2hhcmVMYWJlbEluZm8uY29sb3IgPSBjb21wLm5vZGUuY29sb3I7XG4gICAgICAgIHNoYXJlTGFiZWxJbmZvLmhhc2ggPSBjb21wdXRlSGFzaChzaGFyZUxhYmVsSW5mbyk7XG4gICAgfVxuXG4gICAgX2dldEZvbnREZXNjICgpIHtcbiAgICAgICAgbGV0IGZvbnREZXNjID0gc2hhcmVMYWJlbEluZm8uZm9udFNpemUudG9TdHJpbmcoKSArICdweCAnO1xuICAgICAgICBmb250RGVzYyA9IGZvbnREZXNjICsgc2hhcmVMYWJlbEluZm8uZm9udEZhbWlseTtcbiAgICAgICAgaWYgKF9pc0JvbGQpIHtcbiAgICAgICAgICAgIGZvbnREZXNjID0gXCJib2xkIFwiICsgZm9udERlc2M7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZm9udERlc2M7XG4gICAgfVxuICAgIF9jb21wdXRlSG9yaXpvbnRhbEtlcm5pbmdGb3JUZXh0ICgpIHt9XG4gICAgX2RldGVybWluZVJlY3QgKHRlbXBSZWN0KSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG59Il19